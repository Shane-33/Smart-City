/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{version as n}from"../../kernel.js";import e from"../Dictionary.js";import{ArcadeExecutionError as t,ExecutionErrorCodes as r}from"../executionError.js";import{cloneGeometry as i,convertSquareUnitsToCode as a,convertLinearUnitsToCode as l}from"../kernel.js";import{F as o,E as f,k as s,n as u,m as c,j as m,o as h,q as w,A as d,G as p,H as g,J as v,K as P,g as I,h as y,L as x}from"../../chunks/languageUtils.js";import{centroidPolyline as R,centroidMultiPoint as N,getMetersPerVerticalUnitForSR as j,segmentLength3d as L}from"./centroid.js";import{getMetersPerUnitForSR as b}from"../../core/unitUtils.js";import k from"../../geometry/Extent.js";import A from"../../geometry/Geometry.js";import E from"../../geometry/Multipoint.js";import M from"../../geometry/Point.js";import Z from"../../geometry/Polygon.js";import D from"../../geometry/Polyline.js";import{fromJSON as O}from"../../geometry/support/jsonUtils.js";let q=null;function z(e){return 0===n.indexOf("4.")?Z.fromExtent(e):new Z({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function C(n){q=n}function J(n,e){if("polygon"!==n.type&&"polyline"!==n.type&&"extent"!==n.type)return 0;let t=1;if(n.spatialReference.vcsWkid||n.spatialReference.latestVcsWkid){t=j(n.spatialReference)/b(n.spatialReference)}let r=0;if("polyline"===n.type)for(const a of n.paths)for(let n=1;n<a.length;n++)r+=L(a[n],a[n-1],t);else if("polygon"===n.type)for(const a of n.rings){for(let n=1;n<a.length;n++)r+=L(a[n],a[n-1],t);(a[0][0]!==a[a.length-1][0]||a[0][1]!==a[a.length-1][1]||void 0!==a[0][2]&&a[0][2]!==a[a.length-1][2])&&(r+=L(a[0],a[a.length-1],t))}else"extent"===n.type&&(r+=2*L([n.xmin,n.ymin,0],[n.xmax,n.ymin,0],t),r+=2*L([n.xmin,n.ymin,0],[n.xmin,n.ymax,0],t),r*=2,r+=4*Math.abs(g(n.zmax,0)*t-g(n.zmin,0)*t));const i=new D({hasZ:!1,hasM:!1,spatialReference:n.spatialReference,paths:[[0,0],[0,r]]});return q.planarLength(i,e)}function S(n,j){function L(n,e,i){if(f(i,2,2,n,e),i[0]instanceof A&&i[1]instanceof A);else if(i[0]instanceof A&&null===i[1]);else if(i[1]instanceof A&&null===i[0]);else if(null!==i[0]||null!==i[1])throw new t(n,r.InvalidParameter,e)}n.disjoint=function(n,e){return j(n,e,((t,r,i)=>(i=o(i),L(n,e,i),null===i[0]||null===i[1]||q.disjoint(i[0],i[1]))))},n.intersects=function(n,e){return j(n,e,((t,r,i)=>(i=o(i),L(n,e,i),null!==i[0]&&null!==i[1]&&q.intersects(i[0],i[1]))))},n.touches=function(n,e){return j(n,e,((t,r,i)=>(i=o(i),L(n,e,i),null!==i[0]&&null!==i[1]&&q.touches(i[0],i[1]))))},n.crosses=function(n,e){return j(n,e,((t,r,i)=>(i=o(i),L(n,e,i),null!==i[0]&&null!==i[1]&&q.crosses(i[0],i[1]))))},n.within=function(n,e){return j(n,e,((t,r,i)=>(i=o(i),L(n,e,i),null!==i[0]&&null!==i[1]&&q.within(i[0],i[1]))))},n.contains=function(n,e){return j(n,e,((t,r,i)=>(i=o(i),L(n,e,i),null!==i[0]&&null!==i[1]&&q.contains(i[0],i[1]))))},n.overlaps=function(n,e){return j(n,e,((t,r,i)=>(i=o(i),L(n,e,i),null!==i[0]&&null!==i[1]&&q.overlaps(i[0],i[1]))))},n.equals=function(n,e){return j(n,e,((t,r,i)=>(f(i,2,2,n,e),i[0]===i[1]||(i[0]instanceof A&&i[1]instanceof A?q.equals(i[0],i[1]):(s(i[0])&&s(i[1])||u(i[0])&&u(i[1])||!(!c(i[0])||!c(i[1])))&&i[0].equals(i[1])))))},n.relate=function(n,e){return j(n,e,((i,a,l)=>{if(l=o(l),f(l,3,3,n,e),l[0]instanceof A&&l[1]instanceof A)return q.relate(l[0],l[1],m(l[2]));if(l[0]instanceof A&&null===l[1])return!1;if(l[1]instanceof A&&null===l[0])return!1;if(null===l[0]&&null===l[1])return!1;throw new t(n,r.InvalidParameter,e)}))},n.intersection=function(n,e){return j(n,e,((t,r,i)=>(i=o(i),L(n,e,i),null===i[0]||null===i[1]?null:q.intersect(i[0],i[1]))))},n.union=function(n,e){return j(n,e,((a,l,f)=>{const s=[];if(0===(f=o(f)).length)throw new t(n,r.WrongNumberOfParameters,e);if(1===f.length)if(h(f[0])){const i=o(f[0]);for(let a=0;a<i.length;a++)if(null!==i[a]){if(!(i[a]instanceof A))throw new t(n,r.InvalidParameter,e);s.push(i[a])}}else{if(!w(f[0])){if(f[0]instanceof A)return d(i(f[0]),n.spatialReference);if(null===f[0])return null;throw new t(n,r.InvalidParameter,e)}{const i=o(f[0].toArray());for(let a=0;a<i.length;a++)if(null!==i[a]){if(!(i[a]instanceof A))throw new t(n,r.InvalidParameter,e);s.push(i[a])}}}else for(let i=0;i<f.length;i++)if(null!==f[i]){if(!(f[i]instanceof A))throw new t(n,r.InvalidParameter,e);s.push(f[i])}return 0===s.length?null:q.union(s)}))},n.difference=function(n,e){return j(n,e,((t,r,a)=>(a=o(a),L(n,e,a),null!==a[0]&&null===a[1]?i(a[0]):null===a[0]?null:q.difference(a[0],a[1]))))},n.symmetricdifference=function(n,e){return j(n,e,((t,r,a)=>(a=o(a),L(n,e,a),null===a[0]&&null===a[1]?null:null===a[0]?i(a[1]):null===a[1]?i(a[0]):q.symmetricDifference(a[0],a[1]))))},n.clip=function(n,e){return j(n,e,((i,a,l)=>{if(l=o(l),f(l,2,2,n,e),!(l[1]instanceof k)&&null!==l[1])throw new t(n,r.InvalidParameter,e);if(null===l[0])return null;if(!(l[0]instanceof A))throw new t(n,r.InvalidParameter,e);return null===l[1]?null:q.clip(l[0],l[1])}))},n.cut=function(n,e){return j(n,e,((a,l,s)=>{if(s=o(s),f(s,2,2,n,e),!(s[1]instanceof D)&&null!==s[1])throw new t(n,r.InvalidParameter,e);if(null===s[0])return[];if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);return null===s[1]?[i(s[0])]:q.cut(s[0],s[1])}))},n.area=function(n,e){return j(n,e,((i,l,s)=>{if(f(s,1,2,n,e),null===(s=o(s))[0])return 0;if(h(s[0])||w(s[0])){const e=p(s[0],n.spatialReference);return null===e?0:q.planarArea(e,a(g(s[1],-1)))}if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);return q.planarArea(s[0],a(g(s[1],-1)))}))},n.areageodetic=function(n,e){return j(n,e,((i,l,s)=>{if(f(s,1,2,n,e),null===(s=o(s))[0])return 0;if(h(s[0])||w(s[0])){const e=p(s[0],n.spatialReference);return null===e?0:q.geodesicArea(e,a(g(s[1],-1)))}if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);return q.geodesicArea(s[0],a(g(s[1],-1)))}))},n.length=function(n,e){return j(n,e,((i,a,s)=>{if(f(s,1,2,n,e),null===(s=o(s))[0])return 0;if(h(s[0])||w(s[0])){const e=v(s[0],n.spatialReference);return null===e?0:q.planarLength(e,l(g(s[1],-1)))}if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);return q.planarLength(s[0],l(g(s[1],-1)))}))},n.length3d=function(n,e){return j(n,e,((i,a,s)=>{if(f(s,1,2,n,e),null===(s=o(s))[0])return 0;if(h(s[0])||w(s[0])){const e=v(s[0],n.spatialReference);return null===e?0:!0===e.hasZ?J(e,l(g(s[1],-1))):q.planarLength(e,l(g(s[1],-1)))}if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);return!0===s[0].hasZ?J(s[0],l(g(s[1],-1))):q.planarLength(s[0],l(g(s[1],-1)))}))},n.lengthgeodetic=function(n,e){return j(n,e,((i,a,s)=>{if(f(s,1,2,n,e),null===(s=o(s))[0])return 0;if(h(s[0])||w(s[0])){const e=v(s[0],n.spatialReference);return null===e?0:q.geodesicLength(e,l(g(s[1],-1)))}if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);return q.geodesicLength(s[0],l(g(s[1],-1)))}))},n.distance=function(n,e){return j(n,e,((i,a,s)=>{s=o(s),f(s,2,3,n,e);let u=s[0];(h(s[0])||w(s[0]))&&(u=P(s[0],n.spatialReference));let c=s[1];if((h(s[1])||w(s[1]))&&(c=P(s[1],n.spatialReference)),!(u instanceof A))throw new t(n,r.InvalidParameter,e);if(!(c instanceof A))throw new t(n,r.InvalidParameter,e);return q.distance(u,c,l(g(s[2],-1)))}))},n.distancegeodetic=function(n,e){return j(n,e,((i,a,s)=>{s=o(s),f(s,2,3,n,e);const u=s[0],c=s[1];if(!(u instanceof M))throw new t(n,r.InvalidParameter,e);if(!(c instanceof M))throw new t(n,r.InvalidParameter,e);const m=new D({paths:[],spatialReference:u.spatialReference});return m.addPath([u,c]),q.geodesicLength(m,l(g(s[2],-1)))}))},n.densify=function(n,e){return j(n,e,((i,a,s)=>{if(s=o(s),f(s,2,3,n,e),null===s[0])return null;if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);const u=I(s[1]);if(isNaN(u))throw new t(n,r.InvalidParameter,e);if(u<=0)throw new t(n,r.InvalidParameter,e);return s[0]instanceof Z||s[0]instanceof D?q.densify(s[0],u,l(g(s[2],-1))):s[0]instanceof k?q.densify(z(s[0]),u,l(g(s[2],-1))):s[0]}))},n.densifygeodetic=function(n,e){return j(n,e,((i,a,s)=>{if(s=o(s),f(s,2,3,n,e),null===s[0])return null;if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);const u=I(s[1]);if(isNaN(u))throw new t(n,r.InvalidParameter,e);if(u<=0)throw new t(n,r.InvalidParameter,e);return s[0]instanceof Z||s[0]instanceof D?q.geodesicDensify(s[0],u,l(g(s[2],-1))):s[0]instanceof k?q.geodesicDensify(z(s[0]),u,l(g(s[2],-1))):s[0]}))},n.generalize=function(n,e){return j(n,e,((i,a,s)=>{if(s=o(s),f(s,2,4,n,e),null===s[0])return null;if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);const u=I(s[1]);if(isNaN(u))throw new t(n,r.InvalidParameter,e);return q.generalize(s[0],u,y(g(s[2],!0)),l(g(s[3],-1)))}))},n.buffer=function(n,e){return j(n,e,((a,s,u)=>{if(u=o(u),f(u,2,3,n,e),null===u[0])return null;if(!(u[0]instanceof A))throw new t(n,r.InvalidParameter,e);const c=I(u[1]);if(isNaN(c))throw new t(n,r.InvalidParameter,e);return 0===c?i(u[0]):q.buffer(u[0],c,l(g(u[2],-1)))}))},n.buffergeodetic=function(n,e){return j(n,e,((a,s,u)=>{if(u=o(u),f(u,2,3,n,e),null===u[0])return null;if(!(u[0]instanceof A))throw new t(n,r.InvalidParameter,e);const c=I(u[1]);if(isNaN(c))throw new t(n,r.InvalidParameter,e);return 0===c?i(u[0]):q.geodesicBuffer(u[0],c,l(g(u[2],-1)))}))},n.offset=function(n,e){return j(n,e,((i,a,s)=>{if(s=o(s),f(s,2,6,n,e),null===s[0])return null;if(!(s[0]instanceof Z||s[0]instanceof D))throw new t(n,r.InvalidParameter,e);const u=I(s[1]);if(isNaN(u))throw new t(n,r.InvalidParameter,e);const c=I(g(s[4],10));if(isNaN(c))throw new t(n,r.InvalidParameter,e);const h=I(g(s[5],0));if(isNaN(h))throw new t(n,r.InvalidParameter,e);return q.offset(s[0],u,l(g(s[2],-1)),m(g(s[3],"round")).toLowerCase(),c,h)}))},n.rotate=function(n,e){return j(n,e,((i,a,l)=>{l=o(l),f(l,2,3,n,e);let s=l[0];if(null===s)return null;if(!(s instanceof A))throw new t(n,r.InvalidParameter,e);s instanceof k&&(s=Z.fromExtent(s));const u=I(l[1]);if(isNaN(u))throw new t(n,r.InvalidParameter,e);const c=g(l[2],null);if(null===c)return q.rotate(s,u);if(c instanceof M)return q.rotate(s,u,c);throw new t(n,r.InvalidParameter,e)}))},n.centroid=function(n,e){return j(n,e,((a,l,s)=>{if(s=o(s),f(s,1,1,n,e),null===s[0])return null;let u=s[0];if((h(s[0])||w(s[0]))&&(u=P(s[0],n.spatialReference)),null===u)return null;if(!(u instanceof A))throw new t(n,r.InvalidParameter,e);return u instanceof M?d(i(s[0]),n.spatialReference):u instanceof Z?u.centroid:u instanceof D?R(u):u instanceof E?N(u):u instanceof k?u.center:null}))},n.multiparttosinglepart=function(n,e){return j(n,e,((a,l,s)=>{s=o(s),f(s,1,1,n,e);const u=[];if(null===s[0])return null;if(!(s[0]instanceof A))throw new t(n,r.InvalidParameter,e);if(s[0]instanceof M)return[d(i(s[0]),n.spatialReference)];if(s[0]instanceof k)return[d(i(s[0]),n.spatialReference)];const c=q.simplify(s[0]);if(c instanceof Z){const n=[],e=[];for(let t=0;t<c.rings.length;t++)if(c.isClockwise(c.rings[t])){const e=O({rings:[c.rings[t]],hasZ:!0===c.hasZ,hasM:!0===c.hasM,spatialReference:c.spatialReference.toJSON()});n.push(e)}else e.push({ring:c.rings[t],pt:c.getPoint(t,0)});for(let t=0;t<e.length;t++)for(let r=0;r<n.length;r++)if(n[r].contains(e[t].pt)){n[r].addRing(e[t].ring);break}return n}if(c instanceof D){const n=[];for(let e=0;e<c.paths.length;e++){const t=O({paths:[c.paths[e]],hasZ:!0===c.hasZ,hasM:!0===c.hasM,spatialReference:c.spatialReference.toJSON()});n.push(t)}return n}if(s[0]instanceof E){const e=d(i(s[0]),n.spatialReference);for(let n=0;n<e.points.length;n++)u.push(e.getPoint(n));return u}return null}))},n.issimple=function(n,e){return j(n,e,((i,a,l)=>{if(l=o(l),f(l,1,1,n,e),null===l[0])return!0;if(!(l[0]instanceof A))throw new t(n,r.InvalidParameter,e);return q.isSimple(l[0])}))},n.simplify=function(n,e){return j(n,e,((i,a,l)=>{if(l=o(l),f(l,1,1,n,e),null===l[0])return null;if(!(l[0]instanceof A))throw new t(n,r.InvalidParameter,e);return q.simplify(l[0])}))},n.convexhull=function(n,e){return j(n,e,((i,a,l)=>{if(l=o(l),f(l,1,1,n,e),null===l[0])return null;if(!(l[0]instanceof A))throw new t(n,r.InvalidParameter,e);return q.convexHull(l[0])}))},n.nearestcoordinate=function(n,i){return j(n,i,((a,l,s)=>{if(s=o(s),f(s,2,2,n,i),!(s[0]instanceof A||null===s[0]))throw new t(n,r.InvalidParameter,i);if(!(s[1]instanceof M||null===s[1]))throw new t(n,r.InvalidParameter,i);if(null===s[0]||null===s[1])return null;const u=q.nearestCoordinate(s[0],s[1]);return null===u||u.isEmpty?null:e.convertObjectToArcadeDictionary({coordinate:u.coordinate,distance:u.distance},x(n),!1,!0)}))},n.nearestvertex=function(n,i){return j(n,i,((a,l,s)=>{if(s=o(s),f(s,2,2,n,i),!(s[0]instanceof A||null===s[0]))throw new t(n,r.InvalidParameter,i);if(!(s[1]instanceof M||null===s[1]))throw new t(n,r.InvalidParameter,i);if(null===s[0]||null===s[1])return null;const u=q.nearestVertex(s[0],s[1]);return null===u||u.isEmpty?null:e.convertObjectToArcadeDictionary({coordinate:u.coordinate,distance:u.distance},x(n),!1,!0)}))}}export{S as registerFunctions,C as setGeometryEngine};
