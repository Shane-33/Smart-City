/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import{f as t,g as i}from"../../../chunks/vec3.js";import{c as r}from"../../../chunks/vec3f64.js";import{projectPointToVector as o}from"../../projection/projectPointToVector.js";import{validateGeographicFlag as n,isGeographicMesh as s}from"./geographicUtils.js";import{ungeoreference as a,georeference as c}from"./georeference.js";const p="esri.geometry.support.meshUtils.centerAt";function l(e,t,i){if(!e.vertexAttributes?.position)return;const{vertexSpace:r}=e,o=i?.origin??e.origin;if(r.isRelative)n(r,p,i),f(e,t,o);else{s(e.spatialReference,i)?g(e,t,o):d(e,t,o)}}function f(n,s,a){const{vertexSpace:c}=n;if(!c.isRelative)return;const l=u,f=j;if(!o(s,f,n.spatialReference))return void e.getLogger(p).error(`Failed to project centerAt location (wkid:${s.spatialReference.wkid}) to mesh spatial reference (wkid:${n.spatialReference.wkid}). Projection may be possible after calling projection.load().`);if(!o(a,l,n.spatialReference)){const t=n.origin;l[0]=t.x,l[1]=t.y,l[2]=t.z,e.getLogger(p).error(`Failed to project specified origin (wkid:${a.spatialReference.wkid}) to mesh spatial reference (wkid:${n.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}const g=t(k,f,l),d=c.origin;c.origin=i(r(),d,g)}function g(e,t,i){const r=a(e.vertexAttributes,i,{geographic:!0}),{position:o,normal:n,tangent:s}=c(r,t,{geographic:!0});e.vertexAttributes.position=o,e.vertexAttributes.normal=n,e.vertexAttributes.tangent=s,e.vertexAttributesChanged()}function d(t,i,r){const n=u,s=j;if(o(i,s,t.spatialReference)){if(!o(r,n,t.spatialReference)){const i=t.origin;n[0]=i.x,n[1]=i.y,n[2]=i.z,e.getLogger(p).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}m(t.vertexAttributes.position,s,n),t.vertexAttributesChanged()}else e.getLogger(p).error(`Failed to project centerAt location (wkid:${i.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}function m(e,t,i){if(e)for(let r=0;r<e.length;r+=3)for(let o=0;o<3;o++)e[r+o]+=t[o]-i[o]}const j=r(),u=r(),k=r();export{l as centerAt};
