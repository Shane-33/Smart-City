/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import r from"../../../core/Logger.js";import{n as e,i as o,f as t,t as n}from"../../../chunks/mat3.js";import{a as f}from"../../../chunks/mat3f64.js";import{a}from"../../../chunks/mat4f64.js";import{t as i,n as s}from"../../../chunks/vec3.js";import{c}from"../../../chunks/vec3f64.js";import{getSphericalPCPF as m}from"../../spatialReferenceEllipsoidUtils.js";import{computeTranslationToOriginAndRotation as p}from"../../projection/computeTranslationToOriginAndRotation.js";import{projectBuffer as u}from"../../projection/projectBuffer.js";import{isCGCS2000 as y,isMars as P,isMoon as l}from"../spatialReferenceUtils.js";import{y2lat as T}from"../webMercatorUtils.js";import{BufferViewVec3f as F,BufferViewVec3f64 as A}from"../buffer/BufferView.js";import{a as C,n as d}from"../../../chunks/vec32.js";const g=r.getLogger("esri.geometry.support.meshUtils.normalProjection");function j(r,e,o,t,n){return k(t)?(V(U.TO_PCPF,F.fromTypedArray(r),A.fromTypedArray(e),A.fromTypedArray(o),t,F.fromTypedArray(n)),n):(g.error("Cannot convert spatial reference to PCPF"),n)}function _(r,e,o,t,n){return k(t)?(V(U.FROM_PCPF,F.fromTypedArray(r),A.fromTypedArray(e),A.fromTypedArray(o),t,F.fromTypedArray(n)),n):(g.error("Cannot convert to spatial reference from PCPF"),n)}function h(r,e,o){return u(r,e,0,o,m(e),0,r.length/3),o}function O(r,e,o){return u(r,m(o),0,e,o,0,r.length/3),e}function E(r,t,n){return e(N,n),C(t,r,N),o(N)||d(t,t),t}function M(r,t,n){if(e(N,n),C(t,r,N,4),o(N)||d(t,t,4),r!==t)for(let e=3;e<r.length;e+=4)t[e]=r[e];return t}function R(r,e,o,t,n){if(!k(t))return g.error("Cannot convert spatial reference to PCPF"),n;V(U.TO_PCPF,F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),A.fromTypedArray(e),A.fromTypedArray(o),t,F.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let f=3;f<r.length;f+=4)n[f]=r[f];return n}function v(r,e,o,t,n){if(!k(t))return g.error("Cannot convert to spatial reference from PCPF"),n;V(U.FROM_PCPF,F.fromTypedArray(r,16),A.fromTypedArray(e),A.fromTypedArray(o),t,F.fromTypedArray(n,16));for(let f=3;f<r.length;f+=4)n[f]=r[f];return n}function V(r,e,o,f,a,c){if(!e)return;const u=o.count,y=m(a);if(B(a))for(let s=0;s<u;s++)f.getVec(s,b),e.getVec(s,S),p(y,b,w,y),t(N,w),r===U.FROM_PCPF&&n(N,N),i(S,S,N),c.setVec(s,S);else for(let m=0;m<u;m++){f.getVec(m,b),e.getVec(m,S),p(y,b,w,y),t(N,w);const a=T(o.get(m,1));let u=Math.cos(a);r===U.TO_PCPF&&(u=1/u),N[0]*=u,N[1]*=u,N[2]*=u,N[3]*=u,N[4]*=u,N[5]*=u,r===U.FROM_PCPF&&n(N,N),i(S,S,N),s(S,S),c.setVec(m,S)}return c}function k(r){return B(r)||L(r)}function B(r){return r.isWGS84||y(r)||P(r)||l(r)}function L(r){return r.isWebMercator}var U;!function(r){r[r.TO_PCPF=0]="TO_PCPF",r[r.FROM_PCPF=1]="FROM_PCPF"}(U||(U={}));const b=c(),S=c(),w=a(),N=f();export{O as projectFromPCPF,_ as projectNormalFromPCPF,j as projectNormalToPCPF,v as projectTangentFromPCPF,R as projectTangentToPCPF,h as projectToPCPF,E as transformNormal,M as transformTangent};
