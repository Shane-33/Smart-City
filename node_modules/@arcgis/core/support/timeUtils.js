/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import t from"../TimeExtent.js";import{isSome as e}from"../core/arrayUtils.js";import{offsetDate as n}from"../core/timeUtils.js";function i(t){return void 0!==t.timeInfo}async function r(n,r){if(0===n.length)return t.allTime;const l=n.filter(i);await Promise.all(l.map((t=>t.load({signal:r}))));const s=[],o=[];for(const t of l)"feature"!==t?.type&&"map-image"!==t?.type||!t.timeInfo?.hasLiveData?o.push(t):s.push(t);const m=t=>null==t||t.isAllTime,u=o.map((t=>t.timeInfo?.fullTimeExtent));if(u.some(m))return t.allTime;const a=s.map((async t=>{const{timeExtent:e}=await t.fetchRecomputedExtents({signal:r});return e||t.timeInfo?.fullTimeExtent})),f=(await Promise.allSettled(a)).map((t=>"fulfilled"===t.status?t.value:null));if(f.some(m))return t.allTime;return[...f,...u].filter(e).reduce(((t,e)=>t.union(e)))}function l(e){if(!e)return e;const{start:i,end:r}=e;return new t({start:null!=i?n(i,-i.getTimezoneOffset(),"minutes"):i,end:null!=r?n(r,-r.getTimezoneOffset(),"minutes"):r})}function s(e){if(!e)return e;const{start:i,end:r}=e;return new t({start:null!=i?n(i,i.getTimezoneOffset(),"minutes"):i,end:null!=r?n(r,r.getTimezoneOffset(),"minutes"):r})}export{r as getTimeExtentFromLayers,s as toLocalTimeExtent,l as toUTCTimeExtent};
