/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import t from"../request.js";import{fromJSON as e}from"../renderers/support/jsonUtils.js";import{executeQuery as r}from"./query/executeQuery.js";import{parseUrl as o}from"./utils.js";import"../kernel.js";import"../core/urlUtils.js";import"./query/support/AttachmentInfo.js";import"./support/AttachmentQuery.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/Multipoint.js";import"../geometry/Point.js";import"../geometry/Polygon.js";import"../geometry/Polyline.js";import"../geometry/support/normalizeUtils.js";import"../geometry/support/spatialReferenceUtils.js";import"../core/Error.js";import"../core/pbf.js";import"../core/unitUtils.js";import"../geometry/ellipsoidUtils.js";import i from"./support/Query.js";import"../geometry.js";import"./support/FeatureSet.js";import"../layers/graphics/featureConversionUtils.js";import"./support/RelationshipQuery.js";import"./support/TopFeaturesQuery.js";import s from"./support/StatisticDefinition.js";async function n(e,r,i,s){const n=o(e),{source:a,checkValueRange:u}=r,{classificationDefinition:p}=i,m={...i.toJSON(),f:"json"};let c=null;if(c="class-breaks-definition"===p?.type?p.classificationField:p?.attributeField,a){const t={source:a?.toJSON()};m.layer=JSON.stringify(t)}m.classificationDef&&(m.classificationDef=JSON.stringify(m.classificationDef));let f={query:m};s&&(f={...s,...f});const y={url:n.path,field:c,checkValueRange:u},j=n.path+"/generateRenderer";return t(j,f).then((t=>l(y,t)))}function l(t,e){const{field:o,checkValueRange:n,url:l}=t,u=e?.data;if(!u)return;if(!n){const t=a(u);return Promise.resolve(t)}const p=new s({statisticType:"min",onStatisticField:o}),m=new s({statisticType:"max",onStatisticField:o}),c=new i({outStatistics:[p,m]});return r(l,c).then((t=>{const e=t.features[0].attributes;let r=null,o=null;for(const i in e)0===i.toLowerCase().indexOf("min")?r=e[i]:o=e[i];return a(u,r,o)}))}function a(t,r,o){if("classBreaks"===t.type){const i=e(t);return{classBreaks:i.classBreakInfos.map(((t,e)=>(0===e&&null!=r&&(t.minValue=r),e===i.classBreakInfos.length-1&&null!=o&&(t.maxValue=o),{minValue:t.minValue,maxValue:t.maxValue,label:t.label}))),normalizationTotal:i.normalizationTotal}}const{uniqueValueInfos:i}=t;return{uniqueValues:i?.map(((t,e)=>(0===e&&null!=r&&(t.value=r),e===i.length-1&&null!=o&&(t.value=o),{count:t.count,value:t.value,label:t.label})))??[]}}export{n as generateRenderer};
