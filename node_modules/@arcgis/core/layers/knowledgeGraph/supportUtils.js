/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import m from"../../core/Error.js";import{executeQueryStreaming as n}from"../../rest/knowledgeGraphService.js";import i from"../../rest/knowledgeGraph/GraphQueryStreaming.js";function e(n){if(!n.spatialReference.isWGS84)throw new m("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let i;return i=n.xmax>180&&n.xmin<180?[[[n.xmin,n.ymin],[n.xmin,n.ymax],[180,n.ymax],[180,n.ymin],[n.xmin,n.ymin]],[[-180,n.ymin],[-180,n.ymax],[n.xmax-360,n.ymax],[n.xmax-360,n.ymin],[-180,n.ymin]]]:n.xmax>180&&n.xmin>180?[[[n.xmin-360,n.ymin],[n.xmin-360,n.ymax],[n.xmax-360,n.ymax],[n.xmax-360,n.ymin],[n.xmin-360,n.ymin]]]:n.xmax>-180&&n.xmin<-180?[[[n.xmin+360,n.ymin],[n.xmin+360,n.ymax],[180,n.ymax],[180,n.ymin],[n.xmin+360,n.ymin]],[[-180,n.ymin],[-180,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[-180,n.ymin]]]:n.xmax<-180&&n.xmin<-180?[[[n.xmin+360,n.ymin],[n.xmin+360,n.ymax],[n.xmax+360,n.ymax],[n.xmax+360,n.ymin],[n.xmin+360,n.ymin]]]:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]],i}async function a(m,e){const a=[],x=new Map,r=[];if(e.dataModel?.relationshipTypes)for(const n of e.dataModel.relationshipTypes)n.name&&x.set(n.name,[]);for(const n of m)x.has(n.typeName)&&x.get(n.typeName)?.push(n.id);for(const[t,y]of x){if(y.length<1)continue;const m=new i({openCypherQuery:`MATCH (n)-[r:${t}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:y}});r.push(n(e,m).then((async m=>{const n=m.resultRowsStream.getReader();for(;;){const{done:m,value:i}=await n.read();if(m)break;for(const n of i)a.push({id:n[0],typeName:n[1]}),a.push({id:n[2],typeName:n[3]})}})))}return await Promise.all(r),a}export{e as extentToInBoundsRings,a as getRelationshipEndNodeIds};
