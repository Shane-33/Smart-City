/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import"../../geometry.js";import{geographicToWebMercator as e}from"../../geometry/support/webMercatorUtils.js";import r from"../OrientedImageryLayer.js";import t from"./core/ExposurePoint.js";import a from"../../rest/support/Query.js";import o from"../../geometry/Extent.js";const n={},s=1e3;async function i(t,o){const{point:i,queryParams:u,queryFeatures:l}=t,y={};let p=t.layerInstanceOrURL;const f=i.spatialReference.isGeographic?e(i.clone()):i.clone();if(y.outSpatialReference=f.spatialReference,u&&(y.maxRecordCountFactor=u.maxRecordCountFactor??5,y.outFields=u.outFields??["*"],y.where=u.where??"1=1",y.returnGeometry=u.returnGeometry??!0,y.outSpatialReference=u.outSpatialReference),"string"==typeof p&&(n.layer&&n.layer.url===p?p=n.layer:(n.layer?.destroy(),p=n.layer=new r({url:p}),await p.load())),p){if(l&&"esri.layers.OrientedImageryLayer"===p?.declaredClass)return c(p)(l);const e=p,r=m(f,u?.maximumDistance??e.maximumDistance??s),t=new a({geometry:r,...y});return e.queryFeatures(t,o).then(c(e))}return null}function c(e){return r=>{const{features:a,spatialReference:o}=r;return a.forEach((r=>{r.geometry&&(r.geometry.spatialReference=o);const a=t.fromJSON({...r.toJSON(),layer:e});a&&(r.attributes=a),r.layer=e,r.spatialReference=o})),r}}function m(e,r){const t=e.x-r,a=e.x+r,n=e.y-r,s=e.y+r;return new o({xmin:t,xmax:a,ymin:n,ymax:s,spatialReference:e.spatialReference})}export{m as createExtentFromPointAtDistance,i as searchImages};
