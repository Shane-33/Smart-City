/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{save as e,saveAs as r}from"./utils.js";import{createForGroupLayerItemWrite as t}from"../../portal/support/jsonContext.js";import{TypeKeyword as s,hasTypeKeyword as a,addTypeKeyword as o}from"../../portal/support/portalItemUtils.js";import{saveResources as n}from"../../webdoc/support/saveUtils.js";const i="Group Layer",u="group-layer-save",c="group-layer-save-as",l=s.GROUP_LAYER_MAP;function p(e){return{isValid:"group"===e.type,errorMessage:"Layer.type should be 'group'"}}function m(e){return{isValid:a(e,l),errorMessage:`Layer.portalItem.typeKeywords should have '${l}'`}}function y(e){const r=e.layerJSON;return Promise.resolve(r&&Object.keys(r).length?r:null)}async function f(e,r){r.title||=e.title,o(r,l)}async function v(r,s){return e({layer:r,itemType:i,validateLayer:p,validateItem:m,createJSONContext:e=>t(e,r),createItemData:y,errorNamePrefix:u,saveResources:async(e,t)=>(r.sourceIsPortalItem||await e.removeAllResources().catch((()=>{})),n(r.resourceReferences,t))},s)}async function d(e,s,a){return r({layer:e,itemType:i,validateLayer:p,createJSONContext:r=>t(r,e),createItemData:y,errorNamePrefix:c,newItem:s,setItemProperties:f,saveResources:(r,t)=>n(e.resourceReferences,t)},a)}export{v as save,d as saveAs};
