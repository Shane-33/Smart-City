/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import t from"../core/Error.js";import{makeHandle as e}from"../core/handleUtils.js";import{createResolver as n}from"../core/promiseUtils.js";import{beforeLocaleChange as s,getLocale as r}from"./locale.js";const o=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,i={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0},a=Object.keys(i);function c(t){return t in i}const d=[],l=new Map;function u(t){for(const e of l.keys())p(t.pattern,e)&&l.delete(e)}function h(t){return d.includes(t)||(u(t),d.unshift(t)),e((()=>{const e=d.indexOf(t);e>-1&&(d.splice(e,1),u(t))}))}async function f(t){const e=r();l.has(t)||l.set(t,_(t,e));const n=l.get(t);return n&&await g.add(n),n}function m(t){if(!o.test(t))return null;const e=o.exec(t);if(null===e)return null;const[,n,s]=e,r=n+(s?"-"+s.toUpperCase():"");return c(r)?r:c(n)?n:null}async function _(e,n){const s=[];for(const t of d)if(p(t.pattern,e))try{return await t.fetchMessageBundle(e,n)}catch(r){s.push(r)}if(s.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:s});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function p(t,e){return"string"==typeof t?e.startsWith(t):t.test(e)}s((()=>{l.clear()}));const g=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=n())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}},w={cache:l,loaders:d};export{f as fetchMessageBundle,a as messageBundlesLocales,m as normalizeMessageBundleLocale,h as registerMessageBundleLoader,w as test};
