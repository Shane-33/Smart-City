/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import{property as e}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/accessorSupport/ensureType.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import{subclass as i}from"../../../core/accessorSupport/decorators/subclass.js";import{tooltipKeys as n}from"../keybindings.js";import{base as o}from"./css.js";import s from"../../../widgets/Widget.js";import{loadCalciteComponents as l}from"../../../widgets/support/componentsUtils.js";import"../../../widgets/support/widgetUtils.js";import{tsx as u}from"../../../widgets/support/jsxFactory.js";const r=`${o}-editable-field`,a={base:r,inputMode:`${r}--input`,locked:`${r}--locked`,title:`${r}__title`,titleContent:`${r}__title__content`,value:`${r}__value`,valueContent:`${r}__value__content`,input:`${r}__input`,inputDisabled:`${r}__input--disabled`,inputReadOnly:`${r}__input--read-only`,inputSuffix:`${r}__input-suffix`,button:`${r}__button`};let c=class extends s{constructor(){super(...arguments),this._input=null,this._afterInputCreate=t=>{this._input=t},this._selectText=()=>{requestAnimationFrame((()=>{this._input?.select()}))},this._onKeyDown=t=>{t.key===n.discard&&this._discard()},this._onInputKeyDown=t=>{switch(t.key){case n.commit:return this._commit({type:"commit-and-exit",allowLockingCurrentValue:!0});case n.next:return t.stopPropagation(),this._commit({type:t.shiftKey?"commit-and-previous":"commit-and-next",allowLockingCurrentValue:!1})}},this._onInput=t=>{this.field.inputValue=t.target.value},this._onLockClick=()=>{const{field:t}=this;t.locked?t.unlock():this._lock()}}loadDependencies(){return l({button:()=>import("@esri/calcite-components/dist/components/calcite-button.js"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js")})}render(){const{mode:t,field:e}=this,i="input"===t,{locked:n}=e;return u("div",{class:this.classes({[a.base]:!0,[a.inputMode]:"input"===t,[a.locked]:n})},u("div",{class:a.title,key:"title"},u("div",{class:a.titleContent,key:"title-content"},this._title,n&&!i?u("calcite-icon",{icon:"lock",key:"icon",scale:"s"}):null)),u("div",{class:a.value,key:"value"},i?this._renderInput():u("span",{key:"formatted-value"},this._feedbackValue)))}get _initialValue(){const{field:t}=this;return null!=t.actual?t.toInputUnits(t.actual,this.context).value:null}get _feedbackValue(){const{context:t,field:e}=this,{actual:i,committed:n,format:o}=e;return null!=n?o(n,t):null!=i?o(i,t):""}get _displayValue(){const{field:t}=this,{inputValue:e,committed:i}=t;return null!=e?e:null!=i?this._toString(t.toInputUnits(i,this.context).value):this._toString(this._initialValue)}get _suffix(){const{suffix:t}=this.field;return"string"==typeof t?t:t(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}_renderInput(){const{disabled:t,locked:e,readOnly:i}=this.field;return u("div",{class:a.valueContent,key:"input-container",onkeydown:this._onKeyDown},u("input",{afterCreate:this._afterInputCreate,class:this.classes({[a.input]:!0,[a.inputDisabled]:t,[a.inputReadOnly]:i}),disabled:t||i,onfocus:this._selectText,oninput:this._onInput,onkeydown:this._onInputKeyDown,readOnly:i,type:"text",value:this._displayValue}),u("div",{class:a.inputSuffix,key:"suffix"},this._suffix),i?void 0:u("calcite-button",{appearance:"transparent",class:a.button,disabled:t,iconStart:e?"lock":"unlock",kind:"neutral",onclick:this._onLockClick,scale:"s",tabIndex:-1}))}_commit({type:t,allowLockingCurrentValue:e}){const{_input:i,field:n}=this;i&&(n.locked&&""===n.inputValue?n.unlock():(e||null!=n.inputValue)&&this._lock(),this.context.onCommit(i,t))}_discard(){this._input&&(this.field.inputValue=null,this.context.onDiscard(this._input))}_lock(){const{field:t}=this,e=this._parseNumber(t.inputValue),i=null!=e?t.createQuantity(e,this.context):null;t.lock(i)}_parseNumber(t){if(null==t)return null;const e=parseFloat(t);return isNaN(e)||!isFinite(e)?null:e}_toString(t){return null!=t?t.toFixed(3):"0"}};t([e()],c.prototype,"field",void 0),t([e()],c.prototype,"context",void 0),t([e()],c.prototype,"mode",void 0),t([e()],c.prototype,"_initialValue",null),t([e()],c.prototype,"_feedbackValue",null),t([e()],c.prototype,"_input",void 0),t([e()],c.prototype,"_displayValue",null),t([e()],c.prototype,"_suffix",null),t([e()],c.prototype,"_title",null),c=t([i("esri.views.interactive.tooltip.TooltipEditableField")],c);export{c as TooltipEditableField};
