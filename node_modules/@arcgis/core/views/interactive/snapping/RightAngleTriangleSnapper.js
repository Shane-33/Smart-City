/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{l as e,d as t}from"../../../chunks/vec2.js";import{a as s}from"../../../chunks/vec2f64.js";import{c as i}from"../../../chunks/vec3f64.js";import{absoluteHeightElevationInfo as r}from"../../../support/elevationInfoUtils.js";import{fromAnyMapPoint as o,fromVec3 as n}from"../sketch/normalizedPoint.js";import{SnappingAlgorithm as p}from"./SnappingAlgorithm.js";import{squaredScreenDistance as a}from"./snappingUtils.js";import{RightAngleTriangleSnappingCandidate as d}from"./candidates/RightAngleTriangleSnappingCandidate.js";import{vectorToScreenPoint as c}from"../support/viewUtils.js";import{projectPointToCircle as m}from"../../support/geometry2dUtils.js";class l extends p{snapNewVertex(e,t){const s=t.editGeometryOperations.data.components[0],i=[],r=s.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;const{view:n}=this,p=s.vertices[0],a=s.vertices[r-1],d=o(p.pos,n,t),c=o(a.pos,n,t);return this._processCandidateProposal(d,c,e,t,i),i}snapExistingVertex(e,t){const s=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return s;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===r.vertices.length-1))return s;const{view:n}=this,p=o(i.leftEdge.leftVertex.pos,n,t),a=o(i.rightEdge.rightVertex.pos,n,t);return this._processCandidateProposal(p,a,e,t,s),s}_processCandidateProposal(s,o,p,l,f){if(!this.exceedsShortLineThreshold(s,o,l))return;const g=e(h,s,o,.5),u=.5*t(s,o),v=i();m(v,p,g,u),v[2]=p[2];const x=n(v),{spatialReference:j,pointer:y}=l,w=c(p,j,r,this.view);if(a(w,c(x,j,r,this.view))<this.squaredProximityThreshold(y)){if(this.isVertical(s,x)||this.isVertical(x,o))return;f.push(new d({targetPoint:x,point1:s,point2:o,isDraped:"on-the-ground"===l.elevationInfo?.mode}))}}}const h=s();export{l as RightAngleTriangleSnapper};
