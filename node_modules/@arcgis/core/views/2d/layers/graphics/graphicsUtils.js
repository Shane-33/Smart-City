/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{bidiText as e}from"../../../../core/BidiText.js";import{pt2px as t}from"../../../../core/screenUtils.js";import n from"../../../../geometry/Polygon.js";import{create as i}from"../../../../geometry/support/aaBoundingRect.js";import{getInfo as r}from"../../../../geometry/support/spatialReferenceUtils.js";import{getXAnchorDirection as o,getYAnchorDirection as s}from"../../engine/webgl/alignmentUtils.js";import{glyphSize as l,magicLabelLineHeight as a}from"../../engine/webgl/definitions.js";import{shapeGlyphs as m}from"../../engine/webgl/mesh/templates/shapingUtils.js";const c=512,f=50;function g(e,t){const n=r(t);if(!n)return null;const[o,s]=n.valid;return e[2]>s?[i([e[0],e[1],s,e[3]]),i([o,e[1],o+e[2]-s,e[3]])]:e[0]<o?[i([o,e[1],e[2],e[3]]),i([s-(o-e[0]),e[1],s,e[3]])]:null}function u(e){return"text"===e||"esriTS"===e}function p(e){return"simple-marker"===e||"picture-marker"===e||"esriSMS"===e||"esriPMS"===e}function h(e){switch(e.geometry.type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}function d(n,i,r){if(!r?.glyphMosaicItems?.length)return n;const c=e(i.text)[1],f=r.glyphMosaicItems,g=m(f,c,{scale:t(i.font.size)/l,angle:i.angle??0,xOffset:i.xoffset??0,yOffset:i.yoffset??0,hAlign:o(i.horizontalAlignment||"center"),vAlign:s(i.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(i.lineWidth||512,512)),lineHeight:a*Math.max(.25,Math.min(i.lineHeight||1,4)),decoration:i.font.decoration||"none",isCIM:!1,hasBackground:!!i.backgroundColor,borderLineSize:i.borderLineSize}).bounds;return n[0]=t(g.x-g.halfWidth),n[1]=t(g.y-g.halfHeight),n[2]=t(g.width),n[3]=t(g.height),n}function x(e){if(!e)return null;const{xmin:t,ymin:i,xmax:r,ymax:o,spatialReference:s}=e;return new n({rings:[[[t,i],[t,o],[r,o],[r,i],[t,i]]],spatialReference:s})}export{d as getTextSymbolSize,h as graphicGeometryToNumber,g as intersectingInternationalDateline,p as isMarkerSymbol,u as isTextSymbol,f as pixelBuffer,x as polygonFromExtent,c as tileSize};
