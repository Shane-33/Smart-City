/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import o from"../../core/Accessor.js";import e from"../../core/Error.js";import i from"../../core/Logger.js";import{throwIfAborted as r}from"../../core/promiseUtils.js";import{whenOnce as s}from"../../core/reactiveUtils.js";import{property as n}from"../../core/accessorSupport/decorators/property.js";import"../../core/accessorSupport/ensureType.js";import"../../core/arrayUtils.js";import"../../core/has.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import c from"../ViewAnimation.js";import{create as m}from"./viewpointUtils.js";let p=class extends o{constructor(t){super(t),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(t,o){if(!t)return void i.getLogger(this).error("#goTo()","target cannot be null or undefined");this.view.animation&&(this.view.animation=null);const e=this._createAnimation();await s((()=>this.view.ready),o);const r={animate:!0,...o},{extent:n,spatialReference:a,size:c,viewpoint:p,constraints:l,padding:h,allLayerViews:w}=this.view,g=m(t,{extent:n,spatialReference:a,size:c,viewpoint:p,constraints:l,padding:h,allLayerViews:w,pickClosestTarget:o?.pickClosestTarget??!0});return e?.update(g),this._gotoTask={},r.animate?this._gotoAnimated(g,r):this._gotoImmediate(g,r)}_gotoImmediate(t,o){const i=this._gotoTask,s=this.view.animation,n=t.then((t=>{if(r(o),i!==this._gotoTask)throw new e("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=s.target=t,s.finish()}));return this._cancellableGoTo(i,s,n)}_gotoAnimated(t,o){const i=this._gotoTask,s=this.view.animation;if(!s)return Promise.resolve();const n=t.then((t=>{if(r(o),i!==this._gotoTask)throw new e("view:goto-interrupted","Goto was interrupted");return s.update(t),this.view.animationManager.animate(s,this.view.viewpoint,o),s.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(i,s,n)}_createAnimation(){return this.view.animation&&!this.view.animation.done||(this.view.animation=new c),this.view.animation}_cancellableGoTo(t,o,e){const i=()=>t===this._gotoTask;return e.finally((()=>{i()&&(o.done||o.stop(),this.view.animation=null)}))}};t([n({constructOnly:!0})],p.prototype,"view",void 0),p=t([a("esri.views.2d.GoToManager")],p);export{p as GoToManager};
