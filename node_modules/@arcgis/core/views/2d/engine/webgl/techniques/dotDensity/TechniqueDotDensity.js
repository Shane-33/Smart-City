/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{writeColor as e}from"../../color.js";import{dotDensityMaxFields as t}from"../../definitions.js";import{Technique as o}from"../Technique.js";import{DataType as r}from"../../../../../webgl/enums.js";class a extends o{static getStorageSpec({attributes:e}){return{visualVariables:!1,attributes:e??null}}static _createRendererSchema(){return{type:"dot-density",colors:new Float32Array(32),dotValue:-1,dotSize:-1,dotScale:-1,dotBlending:!1,backgroundColor:new Float32Array(4),activeDots:new Float32Array(8),seed:-1}}static createOrUpdateRendererSchema(o,r){const{attributes:a,dotValue:n,referenceScale:i,dotSize:l,dotBlendingEnabled:d,seed:s,backgroundColor:c}=r,u=null!=o&&"dot-density"===o.type?o:this._createRendererSchema();u.dotValue=n,u.dotSize=l,u.dotScale=i,u.dotBlending=d,u.seed=s;const{colors:m,activeDots:g,backgroundColor:p}=u;for(let y=0;y<t;y++){const t=y>=a.length?null:a[y].color;e(m,t,4*y)}for(let e=0;e<8;e++)g[e]=e<r.attributes.length?1:0;return e(p,c),u}static getVariation(e){return{ddDotBlending:e.dotBlending}}static getVariationHash(e){return e.dotBlending?1:0}}a.type="dot-density",a.programSpec={shader:"materials/fill",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:r.SHORT},{location:1,name:"a_id",count:3,type:r.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:r.UNSIGNED_BYTE},{location:3,name:"a_inverseArea",count:1,type:r.FLOAT}]}};export{a as DotDensityTechnique};
