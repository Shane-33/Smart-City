/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import e from"../../../../../../Color.js";import{pt2px as t}from"../../../../../../core/screenUtils.js";import{writeColor as o}from"../../color.js";import{chartMaxFields as r}from"../../definitions.js";import{Technique as a}from"../Technique.js";import{DataType as n}from"../../../../../webgl/enums.js";class i extends a{static getStorageSpec({attributes:e}){return{visualVariables:!0,attributes:e??null}}static _createRendererSchema(){return{type:"pie-chart",colors:new Float32Array(4*r),defaultColor:new Float32Array(4),othersColor:new Float32Array(4),outlineColor:new Float32Array(4),holePercentage:0,sectorThreshold:0,outlineWidth:1,numberOfFields:10}}static createOrUpdateRendererSchema(a,n){const{attributes:i,defaultColor:l,holePercentage:s,othersCategory:c,outline:u}=n,m=null!=a&&"pie-chart"===a.type?a:this._createRendererSchema();for(let t=0;t<r;t++){const r=t>=i.length?new e([0,0,0,0]):i[t].color;o(m.colors,r,4*t)}return o(m.defaultColor,l),o(m.othersColor,c?.color),o(m.outlineColor,u?.color),m.outlineWidth=t(u?.width||0),m.holePercentage=s,m.sectorThreshold=c?.threshold||0,m.numberOfFields=i.length,m}static getVariation(e){return{numberOfFields:e.numberOfFields}}static getVariationHash(e){return e.numberOfFields}}i.type="pie-chart",i.programSpec={shader:"materials/pie",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:n.SHORT},{location:1,name:"a_vertexOffset",count:2,type:n.SHORT},{location:2,name:"a_texCoords",count:2,type:n.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:n.UNSIGNED_SHORT},{location:4,name:"a_id",count:4,type:n.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:n.UNSIGNED_BYTE,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:n.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:n.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:n.UNSIGNED_SHORT}]},hittestAttributes:["a_vertexOffset","a_texCoords"]};export{i as PieChartTechnique};
