/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{TranslateAnchor as e}from"../../vectorTiles/style/StyleDefinition.js";import{WGLDrawPhase as t}from"../enums.js";import{u32to4Xu8 as r}from"../number.js";import i from"./WGLBrush.js";import{CompareFunction as n,PrimitiveType as a,DataType as s}from"../../../../webgl/enums.js";class o extends i{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(i,o){const{context:l,displayLevel:c,requiredLevel:u,state:d,drawPhase:f,painter:m,spriteMosaic:p,styleLayerUID:y,requestRender:v,allowDelayedRender:g}=i;if(!o.some((e=>e.layerData.get(y)?.circleIndexCount??!1)))return;const E=i.styleLayer,M=E.circleMaterial,T=m.vectorTilesMaterialManager,I=1.2,U=E.getPaintValue("circle-translate",c),_=E.getPaintValue("circle-translate-anchor",c),x=f===t.HITTEST,R=this._programOptions;R.id=x;const h=T.getMaterialProgram(l,M,R);if(g&&null!=v&&!h.compiled)return void v();l.useProgram(h),h.setUniformMatrix3fv("u_displayMat3",_===e.VIEWPORT?d.displayMat3:d.displayViewMat3),h.setUniform2fv("u_circleTranslation",U),h.setUniform1f("u_depth",E.z),h.setUniform1f("u_antialiasingWidth",I);let D=-1;if(x){const e=r(y+1);h.setUniform4fv("u_id",e)}for(const e of o){if(!e.layerData.has(y))continue;e.key.level!==D&&(D=e.key.level,M.setDataUniforms(h,c,E,D,p));const t=e.layerData.get(y);if(!t.circleIndexCount)continue;t.prepareForRendering(l);const r=t.vao;null!=r&&(l.bindVAO(r),h.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),u!==e.key.level?l.setStencilFunction(n.EQUAL,e.stencilRef,255):l.setStencilFunction(n.GREATER,255,255),l.drawElements(a.TRIANGLES,t.circleIndexCount,s.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.circleIndexStart),e.triangleCount+=t.circleIndexCount/3)}}}export{o as WGLBrushVTLCircle};
