/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{WGLGeometryType as t}from"../enums.js";import{createProgramDescriptor as e}from"../Utils.js";import o from"./WGLGeometryBrush.js";import{TextMaterialKey as a}from"../materialKey/MaterialKey.js";import{PrimitiveType as n,DataType as r}from"../../../../webgl/enums.js";const s=t=>e(t.data,{geometry:[{location:0,name:"a_pos",count:2,type:r.SHORT},{location:1,name:"a_id",count:4,type:r.UNSIGNED_BYTE},{location:2,name:"a_color",count:4,type:r.UNSIGNED_BYTE,normalized:!0},{location:3,name:"a_haloColor",count:4,type:r.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_texFontSize",count:4,type:r.UNSIGNED_BYTE},{location:5,name:"a_aux",count:4,type:r.BYTE},{location:6,name:"a_zoomRange",count:2,type:r.UNSIGNED_SHORT},{location:7,name:"a_vertexOffset",count:2,type:r.SHORT},{location:8,name:"a_texCoords",count:2,type:r.UNSIGNED_SHORT}]});class i extends o{dispose(){}getGeometryType(){return t.TEXT}supportsSymbology(t){return!0}drawGeometry(t,e,o,i){const{context:m,painter:l,rendererInfo:u,state:d,passOptions:f,requestRender:_,allowDelayedRender:p}=t,c=a.load(o.materialKey),y=null!=f&&"hittest"===f.type,{bufferLayouts:E,attributes:N}=s(c),U=l.materialManager.getMaterialProgram(t,c,"materials/text",N,i);if(p&&null!=_&&!U.compiled)return void _();m.useProgram(U);let S=n.TRIANGLES;y&&(S=n.POINTS),this._setSharedUniforms(U,t,e),l.textureManager.bindTextures(m,U,c),U.setUniformMatrix3fv("u_displayMat3",d.displayMat3),U.setUniformMatrix3fv("u_displayViewMat3",d.displayViewMat3),this._setSizeVVUniforms(c,U,u,e),this._setColorAndOpacityVVUniforms(c,U,u),this._setRotationVVUniforms(c,U,u);const T=o.target.getVAO(m,E,N),x=o.indexFrom*Uint32Array.BYTES_PER_ELEMENT;m.bindVAO(T),U.setUniform1f("u_isHaloPass",0),U.setUniform1f("u_isBackgroundPass",1),m.drawElements(S,o.indexCount,r.UNSIGNED_INT,x),U.setUniform1f("u_isHaloPass",1),U.setUniform1f("u_isBackgroundPass",0),m.drawElements(n.TRIANGLES,o.indexCount,r.UNSIGNED_INT,x),U.setUniform1f("u_isHaloPass",0),U.setUniform1f("u_isBackgroundPass",0),m.drawElements(S,o.indexCount,r.UNSIGNED_INT,x)}}export{i as default};
