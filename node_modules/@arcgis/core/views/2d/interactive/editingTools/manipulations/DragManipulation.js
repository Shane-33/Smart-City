/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{Manipulation as t,ManipulatorType as i}from"./Manipulation.js";import{createManipulatorDragEventPipeline as r,screenToMap as a}from"../../../../interactive/dragEventPipeline.js";import{GraphicManipulator as o}from"../../../../interactive/GraphicManipulator.js";import{AccumulationBehaviour as e}from"../../../../interactive/editGeometry/interfaces.js";import{getSymbolInfo as s}from"../../../../interactive/support/utils.js";class n extends t{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(t){t(this._manipulator,i.TRANSLATE_XY)}createDragPipeline(t,i){let o=null,n=null,c=0,l=0,p=0;const{offsetX:m,offsetY:h,size:u}=s(this._graphic.symbol);return r(this._manipulator,((r,s)=>{s.next((i=>{if("start"===i.action){const i=t();o=i.editGeometryOperations,n=i.constraints}return i})).next(a(this._view)).next((t=>{const{x:r,y:a,z:s}=t.mapEnd;if(n&&(r+m<n.xmin||a+h-u<n.ymin||r+m>n.xmax||a+h-u>n.ymax))return t;("start"===t.action||0===c&&0===l&&0===p)&&(c=t.mapStart.x,l=t.mapStart.y,p=t.mapStart.z);const _=r-c,f=a-l,v=s-p;c=r,l=a,p=s;const x=[];for(const i of o.data.components)x.push(...i.vertices);const d="start"===t.action?e.NEW_STEP:e.ACCUMULATE_STEPS,E=o.moveVertices(x,_,f,v,d);return i(t,E),t}))}))}_createManipulator(){const t=this._view,i=this._graphic;return new o({view:t,graphic:i,selectable:!0,cursor:"move"})}}export{n as DragManipulation};
