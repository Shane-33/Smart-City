/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{floatEqualAbsolute as t}from"../../core/mathUtils.js";import{c as n,v as r,g as s,w as e,b as o,h as c,d as u,k as a,l as i,s as f}from"../../chunks/vec2.js";import{a as p,d as h,Z as L,f as d}from"../../chunks/vec2f64.js";import{s as m,u as A,j as E,q as N,o as y,b as l,k as P,c as j,f as M,F as I}from"../../chunks/vec3.js";import{c as k,g as R}from"../../chunks/vec3f64.js";import{create as Y,fromPositionAndNormal as b,distance as v,intersectLine as q,isPointInside as F}from"../../geometry/support/plane.js";import{tangentFrame as g}from"../3d/support/mathUtils.js";import{LineType as H,intersectLineLikeAndCircle as _}from"./geometry2dUtils.js";function U({start:t,end:o,type:c},u,a){const i=[],f=n(ut,o,t),h=n(at,t,u),L=r(f),d=2*s(f,h),m=d*d-4*L*(r(h)-a*a);if(0===m){const n=-d/(2*L);(c===rt.PLANE||n>=0)&&i.push(e(p(),t,f,n))}else if(m>0){const n=Math.sqrt(m),r=(-d+n)/(2*L);(c===rt.PLANE||r>=0)&&i.push(e(p(),t,f,r));const s=(-d-n)/(2*L);(c===rt.PLANE||s>=0)&&i.push(e(p(),t,f,s))}return i}function w(t,r){const e=t.start,c=t.end,u=n(ut,c,e),a=m(at,-u[1],u[0],0),i=r.start,f=r.end,p=A(it,f,i),h=E(p,a),L=m(ft,e[0],e[1],0),d=A(pt,L,i),y=E(d,a);if(Math.abs(h)<et)return Math.abs(y),[];const l=N(ht,i,p,y/h);if(r.type===H.RAY){const t=A(Lt,l,i);if(E(t,p)<-et)return[]}if(t.type===rt.HALF_PLANE){const t=o(Lt,l,e);if(s(t,u)<-et)return[]}return[R(l)]}function x(t,n){return S(W(mt,n[2],t),n)}function C(t,n){const r=0,s=Q(W(mt,r,t),W(At,r,n)),e=[];for(const o of s)e.push(h(o));return e}function Z(t,n){return G(t,W(mt,t[2],n))}function z(t,n){return J(W(mt,t[2],n),t)}function B(t,r,s){const o=n(ut,t,r),u=s/c(o),a=e(k(),r,o,u);return a[2]=t[2],a}function D(t,n,r){return u(t,n)-r}function G(t,{start:n,end:r,type:s}){const e=A(ut,t,n),o=A(at,r,n),c=E(e,o)/E(o,o);return N(k(),n,o,s===H.RAY?Math.max(c,0):c)}function J({start:t,end:n,type:r},s){const e=A(ut,s,t),o=A(at,n,t);if(r===H.RAY&&E(o,e)<-et)return y(t,s);const c=l(it,o,e);return P(c)/P(o)}const K=(()=>{const t=k(),n=k(),r=k();return({start:s,end:e},{center:o,radius:c,normal:u,slicePlane:a})=>{const i=k(),p=b(o,u,dt);if($(v(p,s),0)&&$(v(p,e),0)){g(u,t,n);const i=(s,e)=>(M(r,e,o),f(s,E(r,t),E(r,n)),s),p=_({start:i(ot,s),end:i(ct,e),type:H.LINE},L,c),h=[];for(const[r,s]of p){const e=j(k(),o);N(e,e,t,r),N(e,e,n,s),a&&!nt(a,e)||h.push(e)}return h}return q(p,s,e,i)?!$(y(i,o),c)||a&&!nt(a,i)?[]:[i]:[]}})();function O({start:t,end:e,type:o},c,u){const a=[],i=M(ut,e,t),f=n(at,t,c),p=r(i),h=2*s(i,f),L=h*h-4*p*(r(f)-u*u);if(0===L){const n=-h/(2*p);(o===H.LINE||n>=0)&&a.push(N(k(),t,i,n))}else if(L>0){const n=Math.sqrt(L),r=(-h+n)/(2*p);(o===H.LINE||r>=0)&&a.push(N(k(),t,i,r));const s=(-h-n)/(2*p);(o===H.LINE||s>=0)&&a.push(N(k(),t,i,s))}return a}function Q(n,r){const s=n.start,e=n.end,o=r.start,c=r.end,u=A(ut,e,s),a=A(at,c,o),i=A(it,o,s),f=l(ft,u,a),p=E(i,f);if(!t(p,0,et))return[];const h=I(f);if(t(h,0,et))return[];const L=l(pt,i,a),d=E(L,f)/h,m=N(ht,s,u,d);if(n.type===H.RAY){const t=A(Lt,m,s);if(E(u,t)<-et)return[]}if(r.type===H.RAY){const t=A(Lt,m,o);if(E(a,t)<-et)return[]}return[R(m)]}function S({start:t,end:n,type:r},s){const e=A(ut,s,t),o=A(at,n,t),c=l(it,o,e);if(I(c)/I(o)<et)switch(r){case H.LINE:return[R(s)];case H.RAY:return E(o,e)<-et?[]:[R(s)]}return[]}function T(n,r,s){return t(a(s,n),r*r,et)?[R(s)]:[]}function V(t,n,r,s){const[e,o]=t,[c,u]=r,a=c-e,f=u-o,p=a*a+f*f,h=Math.sqrt(p);if(h>n+s)return[];if(h<Math.abs(n-s))return[];if($(h,0)&&$(n,s))return[];const L=(n*n-s*s+p)/(2*h),m=Math.sqrt(n*n-L*L),A=m*f/h,E=m*a/h,[N,y]=i(ot,t,r,L/h);return $(A,E)?[d(N,y)]:[d(N+A,y-E),d(N-A,y+E)]}function W(t,n,{start:r,end:s,type:e}){return m(t.start,r[0],r[1],n),m(t.end,s[0],s[1],n),t.type=st[e],t}function X(t,n){return $(t[2],n[2])}function $(t,n){return Math.abs(t-n)<et}function tt(t,n){return n.filter((n=>nt(t,n)))}function nt(t,n){return F(t,n)}var rt;!function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"}(rt||(rt={}));const st={[rt.PLANE]:H.LINE,[rt.HALF_PLANE]:H.RAY},et=1e-6,ot=p(),ct=p(),ut=k(),at=k(),it=k(),ft=k(),pt=k(),ht=k(),Lt=k(),dt=Y(),mt={start:k(),end:k(),type:H.LINE},At={start:k(),end:k(),type:H.LINE};export{H as LineType,rt as VerticalPlaneType,et as epsilon,S as intersectLineAndPoint,K as intersectLineLikeAndCircle,O as intersectLineLikeAndVerticalCylinder,Q as intersectLineLikes,T as intersectVerticalCylinderAndPoint,V as intersectVerticalCylinders,w as intersectVerticalPlaneAndLineLike,x as intersectVerticalPlaneAndPoint,U as intersectVerticalPlaneAndVerticalCylinder,C as intersectVerticalPlanes,$ as isClose,nt as isPointInsidePlane,J as pointToLineLikeDistance,D as pointToVerticalCylinderDistance,z as pointToVerticalPlaneDistance,tt as pointsInsidePlane,G as projectPointToLineLike,B as projectPointToVerticalCylinder,Z as projectPointToVerticalPlane,X as vectorsHaveCloseZ};
