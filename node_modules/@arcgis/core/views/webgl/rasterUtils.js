/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{Z as e}from"../../chunks/vec2f64.js";import{ContextType as t}from"./contextUtils.js";import{PixelType as n,SizedPixelFormat as r,PixelFormat as a,TextureSamplingMode as i,TextureWrapMode as o,UniformType as s}from"./enums.js";import{Texture as u}from"./Texture.js";import{TextureDescriptor as f}from"./TextureDescriptor.js";function c(e,s,c="nearest",m=!1){const l=!(m&&"u8"===s.pixelType),_=l?n.FLOAT:n.UNSIGNED_BYTE,p=null==s.pixels||0===s.pixels.length?null:l?s.getAsRGBAFloat():s.getAsRGBA(),g=e.capabilities.textureFloat?.textureFloatLinear,A=new f;return A.width=s.width,A.height=s.height,A.internalFormat=e.type===t.WEBGL2&&l?r.RGBA32F:a.RGBA,A.samplingMode=!g||"bilinear"!==c&&"cubic"!==c?i.NEAREST:i.LINEAR,A.dataType=_,A.wrapMode=o.CLAMP_TO_EDGE,new u(e,A,p)}function m(e,s){const{spacing:c,offsets:m,coefficients:l,size:[_,p]}=s,g=c[0]>1,A=new f;A.width=g?4*_:_,A.height=p,A.internalFormat=e.type===t.WEBGL2?r.RGBA32F:a.RGBA,A.dataType=n.FLOAT,A.samplingMode=i.NEAREST,A.wrapMode=o.CLAMP_TO_EDGE;const T=new Float32Array(g?_*p*16:2*m.length);if(g&&null!=l)for(let t=0,n=0;t<l.length;t++)T[n++]=l[t],t%3==2&&(T[n++]=1);else for(let t=0;t<p;t++)for(let e=0;e<_;e++){const n=4*(t*_+e),r=2*(e*p+t);T[n]=m[r],T[n+1]=m[r+1],T[n+3]=-1===m[r]?0:1}return new u(e,A,T)}function l(e,t){const n=new f;return n.internalFormat=a.RGBA,n.width=t.length/4,n.height=1,n.samplingMode=i.NEAREST,n.wrapMode=o.CLAMP_TO_EDGE,new u(e,n,t)}function _(t,n,r,a=1,i=!0){return{u_flipY:i,u_applyTransform:!!t,u_opacity:a,u_transformSpacing:t?t.spacing:e,u_transformGridSize:t?t.size:e,u_targetImageSize:n,u_srcImageSize:r}}function p(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function g(e,t){return{u_scale:e,u_offset:t}}function A(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function T(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function h(e,t){const n=e.gl,r=t.glName,a=new Map;if(null==r)return a;const i=n.getProgramParameter(r,n.ACTIVE_UNIFORMS);let o;for(let s=0;s<i;s++)o=n.getActiveUniform(r,s),o&&a.set(o.name,{location:n.getUniformLocation(r,o.name),info:o});return a}function E(e,t,n){Object.keys(n).forEach((r=>{const a=t.get(r)||t.get(r+"[0]");a&&x(e,r,n[r],a)}))}function O(e,t,n,r){n.length===r.length&&(r.some((e=>null==e))||n.some((e=>null==e))||n.forEach(((n,a)=>{t.setUniform1i(n,a),e.bindTexture(r[a],a)})))}function x(e,t,n,r){if(null===r||null==n)return!1;const{info:a}=r;switch(a.type){case s.FLOAT:a.size>1?e.setUniform1fv(t,n):e.setUniform1f(t,n);break;case s.FLOAT_VEC2:e.setUniform2fv(t,n);break;case s.FLOAT_VEC3:e.setUniform3fv(t,n);break;case s.FLOAT_VEC4:e.setUniform4fv(t,n);break;case s.FLOAT_MAT3:e.setUniformMatrix3fv(t,n);break;case s.FLOAT_MAT4:e.setUniformMatrix4fv(t,n);break;case s.INT:a.size>1?e.setUniform1iv(t,n):e.setUniform1i(t,n);break;case s.BOOL:e.setUniform1i(t,n?1:0);break;case s.INT_VEC2:case s.BOOL_VEC2:e.setUniform2iv(t,n);break;case s.INT_VEC3:case s.BOOL_VEC3:e.setUniform3iv(t,n);break;case s.INT_VEC4:case s.BOOL_VEC4:e.setUniform4iv(t,n);break;default:return!1}return!0}export{l as createColormapTexture,c as createRasterTexture,m as createTransformTexture,g as getBasicGridUniforms,p as getColormapUniforms,_ as getCommonUniforms,T as getShadedReliefUniforms,A as getStretchUniforms,h as getUniformLocationInfos,O as setTextures,E as setUniforms};
