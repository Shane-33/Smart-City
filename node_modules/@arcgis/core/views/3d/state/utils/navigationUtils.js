/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{cyclicalPI as t}from"../../../../core/Cyclical.js";import{deg2rad as e,clamp as n,acosClamped as o,asinClamped as r}from"../../../../core/mathUtils.js";import{createScreenPointArray as a}from"../../../../core/screenUtils.js";import{c as i,e as s,m as c,k as l}from"../../../../chunks/mat4.js";import{I as m,a as u}from"../../../../chunks/mat4f64.js";import{s as p}from"../../../../chunks/vec2.js";import{a as f}from"../../../../chunks/vec2f64.js";import{f as h,e as M,g as y,l as g,i as b,p as d,s as j,n as v,j as z,a as x,c as P,b as k}from"../../../../chunks/vec3.js";import{c as I}from"../../../../chunks/vec3f64.js";import{create as w,axis as S,fromPoints as E,wrapAxisAngle as A}from"../../../../geometry/support/axisAngle.js";import{coordinateSystemFromOneAxisAndNormalVector as H,vectorCoordinates as U}from"../../../../geometry/support/coordinateSystem.js";import{create as G,intersectRay as q,fromNormalAndOffset as C}from"../../../../geometry/support/plane.js";import{b as F,i as R,c as V}from"../../../../chunks/sphere.js";import{angle as T}from"../../../../geometry/support/vector.js";import{sm4d as O,sv3d as W}from"../../../../geometry/support/vectorStacks.js";import{fromScreen as B,fromScreenAtEye as D}from"../../support/geometryUtils/ray.js";import{intersectScreen as J}from"../../support/geometryUtils/sphere.js";import{Camera as K}from"../../webgl-engine/lib/Camera.js";import{terrainId as L}from"../../webgl-engine/lib/verticalOffsetUtils.js";var N;!function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"}(N||(N={}));const Q=30,X=[1,3e8],Y=80,Z=8,$=200,_=1508e5,tt=5,et=50,nt=5,ot=10,rt=90,at={exclude:new Set([L])};function it(t,e,n){return n[0]=e[0]/(t.fullWidth/t.pixelRatio),n[1]=e[1]/(t.fullHeight/t.pixelRatio),n}function st(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function ct(t,e,n){const o=i(O.get(),n[3],S(n));null==o||s(o,m)||(h(oe,t.eye,e),M(oe,oe,o),t.eye=y(oe,oe,e),h(oe,t.center,e),M(oe,oe,o),t.center=y(oe,oe,e),t.up=M(oe,t.up,o))}function lt(t,e,n,o){return q(t,B(e,n,ce),o)}function mt(t,e,n,o){return q(t,D(e,n,ce),o)}function ut(t,e,n,o){const r=W.get();let a=1-n;h(r,e,t.eye);const i=g(r);let s=i*(1-a);a>=0&&s<o&&(s=o,a=-(s-i)/i),Math.abs(i-s)<1e-6||(b(r,r,a),t.eye=y(oe,t.eye,r),t.center=d(oe,t.center,e,a))}function pt(t,e,n){e.getScreenCenter(ft),J(t,e,ft,oe)&&(e.center=oe);const o=e.distance,r=o*n;if(Math.abs(o-r)<1e-6)return;const a=b(W.get(),e.viewForward,r);e.eye=h(oe,e.center,a)}const ft=a();function ht(t,e){j(e,0,0,0);for(const n of t)y(e,e,n);b(e,e,1/t.length)}function Mt(t,e,n,o){return Math.sin(t/g(e))*(n+o.radius)}function yt(t,e,n,o){return Mt(Math.PI/2,e,n,o)+(t-Math.PI/2)}var gt;!function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"}(gt||(gt={}));const bt={Elevation:3e4,Angle:e(16)},dt={Pole:.95,Angle:e(18),Tilt:45},jt=e(80);function vt(t,e,n,o,r,a){const i=I(),s=V();let c=!0,l=!0;return t.intersectScreen(n,i,a)?s[3]=g(i):(l=!1,e.aboveGround&&r!==N.Ellipsoid?s[3]=Math.max(g(e.center),.9*o.radius):s[3]=g(e.eye)-e.relativeElevation,r===N.Silhouette?kt(s,e,n,i):c=J(s,e,n,i)),{sphere:s,scenePickPoint:c?i:null,hasGeometryIntersection:l}}function zt(t,e,n){if(g(t.eye)-n.radius>bt.Elevation)return gt.Horizontal;D(t,e,le);return-Math.sign(t.relativeElevation)*(.5*Math.PI+T(t.eye,le.direction))<bt.Angle?gt.Vertical:gt.Horizontal}function xt(t,e,n){h(Pt,n,e),t.eye=h(oe,t.eye,Pt),t.center=h(oe,t.center,Pt)}const Pt=I();function kt(t,e,n,o){const r=D(e,n,ce);return null!=r&&(F(t,r,It),R(t,r,o)?!(x(It,r.origin)<x(o,r.origin))||(P(o,It),!1):(h(wt,e.eye,e.center),v(wt,wt),C(wt,-z(v(wt,wt),It),St),q(St,r,o),!1))}const It=I(),wt=I(),St=G();function Et(a,i,s,c,l,m){let u=0;if(k(ie,a,i),h(re,a,i),g(a)<=l||!c.aboveGround){k(s,re,c.eye);const p=z(a,i)/(g(a)*g(i));if(p<.9999)u=o(p);else{const t=g(k(I(),a,i))/(g(a)*g(i));u=r(t)}const f=Math.cos(n(t.normalize(e(m)),0,jt));u=-u-Math.max(0,g(i)-l)/(f*l)}else h(At,c.eye,c.center),k(s,re,At),u=-g(re)/l;return v(s,s),b(s,s,g(ie)),u}const At=I();function Ht(r,a,i,s){let c,l;const m=Math.cos(n(t.normalize(e(s)),0,jt));return c=a>i?-(a-i)/(m*i):a<-i?Math.PI-(a+i)/(m*i):o(a/i),l=r>i?-(r-i)/(m*i):r<-i?Math.PI-(r+i)/(m*i):o(r/i),(l-c)*i}function Ut(t,e,n,o,r,a,i,s,c,l){const m=Ht(t[2],e[2],a[3],s),u=c?Ht(t[0],e[0],a[3],180):e[0]-t[0],f=Math.sin(i)*u-Math.cos(i)*m,h=Math.cos(i)*u+Math.sin(i)*m;v(oe,r);const M=c?f/Math.sqrt(Math.abs(a[3]**2-z(n,oe)**2)):f/a[3],y=h/Math.sqrt(Math.abs(a[3]**2-z(n,o)**2));p(l,M,y)}function Gt(t,e,n,o,r,a,i,s,c,l){k(ie,t,e),H(a.up,a.eye,Lt,Nt,Qt),H([0,0,1],a.eye,Dt,Jt,Kt),P(n,Jt),P(o,Dt),v(n,n),b(n,n,g(ie)),U(t,v(Nt,Nt),v(Qt,Qt),v(Lt,Lt),Xt),U(e,Nt,Qt,Lt,Yt),Ut(Xt,Yt,t,Dt,Jt,i,s,c,l,r)}function qt(t,e,n,o,r,a,s){i(_t,r,o),i(te,s,a),c(ee,_t,te),h(e,t,n),M(e,e,ee),y(e,e,n)}function Ct(t,e,n,o,r,a){i(_t,o,n),i(te,a,r),c(ee,_t,te),h(oe,t.eye,e),M(oe,oe,ee),t.eye=y(oe,oe,e),h(oe,t.center,e),M(oe,oe,ee),t.center=y(oe,oe,e),h(oe,t.up,e),M(oe,oe,ee),t.up=y(oe,oe,e)}function Ft(t,e,n,o,r,a){return(Math.abs(o)>Math.PI-dt.Angle||Math.abs(o)<dt.Angle)&&(Math.abs(t[2])<n*dt.Pole||Math.abs(e)>n)&&a.aboveGround&&r<dt.Tilt}function Rt(t,e,n,o,r,a){if(a)E(n,o,$t),ct(e,t,$t);else{const a=Et(n,o,se,e,t[3],r);ct(e,t,A(se,a))}}function Vt(t,e,n,o,r,a,i){const s=i?20:1,c=1e-12;let l,m;P(ne,o),ae.copyFrom(e);for(let u=0;u<s&&x(n,ne)>c&&(l=x(n,ne),Gt(n,ne,Jt,Dt,Zt,ae,t,r,a,i),Ct(ae,t,Dt,Zt[1],Jt,Zt[0]),qt(ne,ne,t,Dt,Zt[1],Jt,Zt[0]),m=x(n,ne),m<l||0===u);u++)e.copyFrom(ae)}function Tt(n,o,r,a,i,s,c){Ft(r,z(o.up,r),n[3],-t.normalize(e(i)),s,o)?Vt(n,o,r,a,-t.normalize(e(i)),s,c):Rt(n,o,r,a,s,c)}function Ot(t,e,n,o,r,a){const{eye:i}=t;H([0,0,1],i,Dt,Jt,Kt);const s=e.translation[0]*n.pan,c="zoom"===r.mode?0:e.translation[1]*n.pan,m=Math.max(Math.sqrt(Math.abs(1-z(t.center,Dt)**2/g(t.center)**2)),.5),u=(Math.sin(a)*c+Math.cos(a)*s)/m,p=-Math.cos(a)*c+Math.sin(a)*s;switch(l(o.pan.matrix,o.pan.matrix,u,Dt),o.pan.enabled=!0,r.mode){case"pan":l(o.pan.matrix,o.pan.matrix,p,Jt),o.pan.enabled=!0;break;case"zoom":o.zoom=-e.translation[1]*n.zoom}}function Wt(t,e,n,o,r){const{eye:a,viewRight:i}=t,s=k(W.get(),i,a),c=e.translation[0]*n.pan;switch(0!==c&&(l(o.pan.matrix,o.pan.matrix,-c,s),o.pan.enabled=!0),r.mode){case"pan":{const t=e.translation[1]*n.pan;0!==t&&(l(o.pan.matrix,o.pan.matrix,t,i),o.pan.enabled=!0);break}case"zoom":o.zoom=-e.translation[1]*n.zoom}}function Bt(n,o,r,a,i,s,c,l,m){Ft(n.center,z(n.up,n.center),g(n.center),-t.normalize(e(s)),c,o)?Ot(o,r,a,l,m,-t.normalize(e(i))):Wt(o,r,a,l,m)}const Dt=I(),Jt=I(),Kt=I(),Lt=I(),Nt=I(),Qt=I(),Xt=I(),Yt=I(),Zt=f(),$t=w(),_t=u(),te=u(),ee=u(),ne=I(),oe=I(),re=I(),ae=new K,ie=I(),se=I(),ce={origin:I(),direction:I()},le={origin:I(),direction:I()};export{gt as NavigationMode,dt as PreservingHeadingThreshold,N as SpherePickPointFallback,jt as TiltThresholdPanningSpeed,bt as VerticalPanTresholds,xt as applyPanPlanar,Rt as applyPanSphericalDirectRotation,Vt as applyPanSphericalPreserveHeading,ct as applyRotation,Ct as applyRotationWithTwoAxes,pt as applyZoomOnSphere,ut as applyZoomToPoint,ht as centroid,at as contentIntersectorOptions,zt as decideNavigationMode,X as distanceClampValues,lt as intersectPlaneFromScreenPoint,mt as intersectPlaneFromScreenPointAtEye,Ht as lengthFromPoints,et as minHeightLimit,it as normalizeCoordinate,st as normalizeRotationDelta,yt as offSurfaceTiltToEyeTiltGlobal,Mt as onSurfaceTiltToEyeTiltGlobal,tt as panDistanceModifier,Bt as panMotionToRotationMatrix,Tt as panToPosition,vt as pickPointAndInitSphere,Q as pivotDistanceModifier,Ft as preserveHeadingThreshold,nt as rotatePivotDistanceModifier,ot as rotatePivotMinDistanceModifier,qt as rotatePointAroundTwoAxes,rt as rotateScreenPixelArea,Et as rotationAngleAndAxisDirectRotation,Gt as rotationAnglesAndAxesHeadingPreserving,Ut as rotationAnglesHeadingPreserving,Y as screenPixelArea,kt as sphereOrPlanePointFromScreenPoint,Z as zoomDistanceModifier,_ as zoomMaxDistanceModifier,$ as zoomMinDistanceModifier};
