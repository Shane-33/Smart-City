/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../chunks/tslib.es6.js";import{LengthDimensionMeasureType as e}from"../../../../analysis/dimensionUtils.js";import s from"../../../../core/Accessor.js";import{destroyHandle as o}from"../../../../core/handleUtils.js";import r from"../../../../core/Logger.js";import{mapCollection as i,watch as n,syncAndInitial as a}from"../../../../core/reactiveUtils.js";import{convertUnit as l}from"../../../../core/unitUtils.js";import{property as p}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/accessorSupport/ensureType.js";import"../../../../core/arrayUtils.js";import"../../../../core/has.js";import{subclass as c}from"../../../../core/accessorSupport/decorators/subclass.js";import{getDefaultUnitForView as m}from"../../../../support/getDefaultUnitForView.js";import{isGeodesicDimension as u,geodesicDistanceThreshold as d,computeGeometryFromDimension as y,computeLength as h,computationToGeometryDependencies as f}from"./lengthDimensionUtils.js";let g=class extends s{constructor(t){super(t)}initialize(){const t=i((()=>this.analysisViewData.computations),(({computation:t})=>this._watchComputation(t)));this.addHandles(o(t))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return m(this.view)}_watchComputation(t){return n((()=>f(t)),(s=>{const{measureType:o}=s;if(u(s)&&o!==e.Direct){const e=Math.round(l(d,"meters","kilometers"));return r.getLogger(this).warnOnce(`A ${o} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${e} km. Update the measureType of the affected dimension to "direct" to display it.`),void(t.geometry=null)}const i=y(s,this.view.renderCoordsHelper,t.geometry);t.geometry=i,t.result.length=h(i,o,this._defaultUnit)}),a)}};t([p({constructOnly:!0})],g.prototype,"analysisViewData",void 0),t([p({constructOnly:!0})],g.prototype,"view",void 0),t([p()],g.prototype,"analysis",null),t([p()],g.prototype,"_defaultUnit",null),g=t([c("esri.views.3d.analysis.Dimension.support.DimensionController")],g);export{g as DimensionController};
