/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as s}from"../../../../../chunks/tslib.es6.js";import{getAssetUrl as r}from"../../../../../assets.js";import e from"../../../../../core/Accessor.js";import{createTask as t}from"../../../../../core/asyncUtils.js";import a from"../../../../../core/Logger.js";import{abortMaybe as o,disposeMaybe as i}from"../../../../../core/maybe.js";import{throwIfAborted as m}from"../../../../../core/promiseUtils.js";import{property as p}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/accessorSupport/ensureType.js";import"../../../../../core/arrayUtils.js";import"../../../../../core/has.js";import{subclass as c}from"../../../../../core/accessorSupport/decorators/subclass.js";import{requestImage as l}from"../../../../../support/requestImageUtils.js";import{NoParameters as u}from"../../core/shaderModules/interfaces.js";import{ResourceState as n}from"../../lib/basicInterfaces.js";import{PixelFormat as h,TextureSamplingMode as g}from"../../../../webgl/enums.js";import{Texture as _}from"../../../../webgl/Texture.js";import{TextureDescriptor as d}from"../../../../webgl/TextureDescriptor.js";let j=class extends e{constructor(){super(...arguments),this._passParameters=new w,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=o(this._resourcesTask),this._passParameters.waveNormal=i(this._passParameters.waveNormal),this._passParameters.wavePerturbation=i(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(s){return this._resourcesTask||(this._resourcesTask=t((async e=>{await Promise.allSettled([this._loadImageResource(s,r("esri/images/materials/water/normals.jpg"),(s=>this._passParameters.waveNormal=s),e),this._loadImageResource(s,r("esri/images/materials/water/perturbation.jpg"),(s=>this._passParameters.wavePerturbation=s),e)])}))),this._resourcesTask.finished?n.LOADED:n.LOADING}async _loadImageResource(s,r,e,t){try{const a=await l(r,{signal:t});m(t);const o=new d(a.width,a.height);o.pixelFormat=h.RGB,o.samplingMode=g.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,e(new _(s,o,a))}catch(o){a.getLogger(this).error("Failed to load water material normal texture.",o)}}};s([p()],j.prototype,"_resourcesTask",void 0),s([p({type:Boolean,readOnly:!0})],j.prototype,"updating",null),j=s([c("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],j);class w extends u{}export{w as WaterTexturePassParameters,j as WaterTextureRepository};
