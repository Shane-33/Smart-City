/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import o from"../../../../Color.js";import{isCachedFontFace as t,loadFont as e}from"../../../../core/fontUtils.js";import r from"../../../../core/Logger.js";import{pt2px as i}from"../../../../core/screenUtils.js";import{Z as n}from"../../../../chunks/vec4f64.js";class s{constructor(o){this.definition=o,this.key=JSON.stringify(o),this.haloSize=Math.round(o.halo.size),this.textStyle=this._colorToRGBA(o.color),this.haloStyle=this._colorToRGB(o.halo.color),this.backgroundStyle=0!==o.background.color[3]?this._colorToRGBA(o.background.color):null}fontString(o){const t=this.definition.font,e="sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji";return`${t.style} ${t.weight} ${o}px ${t.family}, ${e}`}setFontProperties(o,t){o.font=this.fontString(t),o.textAlign="left",o.textBaseline="alphabetic"}_colorToRGB(o){return`rgb(${o.slice(0,3).map((o=>Math.floor(255*o))).toString()})`}_colorToRGBA(o){return`rgba(${o.slice(0,3).map((o=>Math.floor(255*o))).toString()},${o[3]})`}static async fromSymbol(a,c){const f=a?.material?.color,m=o.toUnitRGBA(f)??n,g=null!=a.size?i(a.size):12,u=a.lineHeight,h=null!=a.background?o.toUnitRGBA(a.background.color):n,d={family:a.font?.family??"sans-serif",decoration:a.font?.decoration??"none",weight:a.font?.weight??"normal",style:a.font?.style??"normal"},y=a.halo,b=null!=y?.color&&y.size>0?{size:i(y.size),color:o.toUnitRGBA(y.color)}:{size:0,color:n},p=new s({color:m,size:g,background:{color:h,padding:null!=a.background?[.65*g,.5*g]:[0,0],borderRadius:null!=a.background?g*(6/16):0},lineSpacingFactor:u,font:d,halo:b,pixelRatio:c});if(a.font){let o=!1;const i=p.fontString(g);try{o=(await document.fonts.load(i)).some((o=>!t(o)))}catch(S){r.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${i}'. Some text symbology may be rendered using the default browser font.`)}if(!o&&!l.has(a.font.family))try{await e(a.font)}catch(S){}}return p}}const l=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);export{s as TextRenderParameters};
