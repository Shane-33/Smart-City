/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{isSome as n}from"../../../../../core/arrayUtils.js";import{isAborted as o,throwIfAborted as t}from"../../../../../core/promiseUtils.js";import{c as e}from"../../../../../chunks/vec3f64.js";import{empty as r,expandWithVec3 as i,center as s,diameter as c}from"../../../../../geometry/support/aaBoundingBox.js";import{LodComponentData as u}from"./LodComponentData.js";class a{static async create(e,r,i){const s=await Promise.allSettled(r.components.map((n=>e.controller.schedule((()=>new u(e,n)),i)))),c=s.map((n=>"fulfilled"===n.status?n.value:null)).filter(n);if(o(i)||c.length!==s.length){c.forEach((n=>n.destroy())),t(i);for(const n of s)if("rejected"===n.status)throw n.reason}return new a(r.minScreenSpaceRadius,c)}constructor(n,o){this.minScreenSpaceRadius=n,this.components=o}destroy(){this.components.forEach((n=>n.destroy()))}intersect(n,o,t,e,r,i,s){this.components.forEach((c=>c.intersect(n,o,t,e,r,i,this.boundingSphere,s)))}get boundingBox(){if(null==this._boundingBox){const n=r();this.components.forEach((o=>{null!=o.boundingInfo&&(i(n,o.boundingInfo.bbMin),i(n,o.boundingInfo.bbMax))})),this._boundingBox=n}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const n=this.boundingBox,o=e();s(n,o),this._boundingSphere={center:o,radius:.5*c(n)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((n,o)=>n+o.triangleCount),0)}}export{a as LodLevel};
