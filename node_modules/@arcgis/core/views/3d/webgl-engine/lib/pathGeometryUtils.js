/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{s as t}from"../../../../chunks/vec2.js";import{j as r,c as e,s,g as o,l as i,n as f,b as m}from"../../../../chunks/vec3.js";import{c as p}from"../../../../chunks/vec3f64.js";import{create as a,fromPositionAndNormal as u,intersectRay as c}from"../../../../geometry/support/plane.js";import{wrap as n}from"../../../../geometry/support/ray.js";import{makeOrthoBasisDirUpFallback as h}from"./GeometryUtil.js";function g(t,r,e){t[0]=e[0]*r.right[0]+e[1]*r.up[0],t[1]=e[0]*r.right[1]+e[1]*r.up[1],t[2]=e[0]*r.right[2]+e[1]*r.up[2]}function v(e,s,o){t(e,r(o,s.right),r(o,s.up))}function l(t,r){let g=null;const v=t.vertices.length,l=.99619469809,R=p(),y=p(),k=p(),L=p(),b=p(),q=p(),x=a();let G=t.vertices[0];e(y,r),s(R,0,1,0),h(G.vRight,y,R,R,k,y,l),e(G.frame.up,y),e(G.frame.right,k);const M=t.positions;let U=t.offset;g=G;for(let p=1;p<v;++p){G=t.vertices[p],o(b,G.vLeft,G.vRight);let r=i(b);r>0?(r=1/Math.sqrt(r),b[0]=b[0]*r,b[1]=b[1]*r,b[2]=b[2]*r):(b[0]=G.vRight[0],b[1]=G.vRight[1],b[2]=G.vRight[2]),q[0]=M[U]+g.frame.up[0],q[1]=M[U+1]+g.frame.up[1],q[2]=M[U+2]+g.frame.up[2],U+=3;const a=s(j,M[U],M[U+1],M[U+2]);u(a,b,x);c(x,n(q,G.vLeft),L)?(L[0]-=M[U],L[1]-=M[U+1],L[2]-=M[U+2],f(y,L),m(k,b,y),f(k,k)):h(b,g.frame.up,g.frame.right,R,k,y,l),e(G.frame.up,y),e(G.frame.right,k),g=G}}const j=p();export{l as computeMinimumRotationTangentFrame,g as profileSpaceToVertexSpace,v as vertexSpaceToProfileSpace};
