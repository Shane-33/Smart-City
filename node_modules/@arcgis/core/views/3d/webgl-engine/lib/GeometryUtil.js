/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{f as t,b as n,n as e,i as s,g as o,j as r,s as h,c as l,e as u}from"../../../../chunks/vec3.js";import{f as c,c as a,a as f}from"../../../../chunks/vec3f32.js";import{c as p}from"../../../../chunks/vec3f64.js";import{newDoubleArray as i}from"../../../../geometry/support/DoubleArray.js";import{newFloatArray as w,floatArrayFrom as g}from"../../../../geometry/support/FloatArray.js";import{getZeroIndexArray as O,getContinuousIndexArray as m}from"../../../../geometry/support/Indices.js";import{create as M,fromPositionAndNormal as A,intersectRay as I}from"../../../../geometry/support/plane.js";import{wrap as y}from"../../../../geometry/support/ray.js";import{Attribute as P}from"./Attribute.js";import{Vec3Compact as N}from"./BufferVectorMath.js";import{ContentObjectType as T}from"./ContentObjectType.js";import{Geometry as S}from"./Geometry.js";import{assert as R}from"./Util.js";import{VertexAttribute as L}from"./VertexAttribute.js";const b=N,j=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],d=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],U=[0,0,1,0,1,1,0,1],V=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],v=new Array(36);for(let At=0;At<6;At++)for(let t=0;t<6;t++)v[6*At+t]=At;const x=new Array(36);for(let At=0;At<6;At++)x[6*At]=0,x[6*At+1]=1,x[6*At+2]=2,x[6*At+3]=2,x[6*At+4]=3,x[6*At+5]=0;function E(t,n){Array.isArray(n)||(n=[n,n,n]);const e=new Array(24);for(let s=0;s<8;s++)e[3*s]=j[s][0]*n[0],e[3*s+1]=j[s][1]*n[1],e[3*s+2]=j[s][2]*n[2];return new S(t,[[L.POSITION,new P(e,V,3,!0)],[L.NORMAL,new P(d,v,3)],[L.UV0,new P(U,x,2)]])}const F=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],G=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],C=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],k=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function q(t,n){Array.isArray(n)||(n=[n,n,n]);const e=new Array(18);for(let s=0;s<6;s++)e[3*s]=F[s][0]*n[0],e[3*s+1]=F[s][1]*n[1],e[3*s+2]=F[s][2]*n[2];return new S(t,[[L.POSITION,new P(e,C,3,!0)],[L.NORMAL,new P(G,k,3)]])}const B=c(-.5,0,-.5),z=c(.5,0,-.5),D=c(0,0,.5),X=c(0,.5,0),Z=a(),H=a(),J=a(),K=a(),Q=a();t(Z,B,X),t(H,B,z),n(J,Z,H),e(J,J),t(Z,z,X),t(H,z,D),n(K,Z,H),e(K,K),t(Z,D,X),t(H,D,B),n(Q,Z,H),e(Q,Q);const W=[B,z,D,X],Y=[0,-1,0,J[0],J[1],J[2],K[0],K[1],K[2],Q[0],Q[1],Q[2]],$=[0,1,2,3,1,0,3,2,1,3,0,2],_=[0,0,0,1,1,1,2,2,2,3,3,3];function tt(t,n){Array.isArray(n)||(n=[n,n,n]);const e=new Array(12);for(let s=0;s<4;s++)e[3*s]=W[s][0]*n[0],e[3*s+1]=W[s][1]*n[1],e[3*s+2]=W[s][2]*n[2];return new S(t,[[L.POSITION,new P(e,$,3,!0)],[L.NORMAL,new P(Y,_,3)]])}function nt(t,n,e,s,o={uv:!0}){const r=-Math.PI,h=2*Math.PI,l=-Math.PI/2,u=Math.PI,c=Math.max(3,Math.floor(e)),a=Math.max(2,Math.floor(s)),f=(c+1)*(a+1),p=w(3*f),i=w(3*f),g=w(2*f),m=[];let M=0;for(let w=0;w<=a;w++){const t=[],e=w/a,s=l+e*u,o=Math.cos(s);for(let l=0;l<=c;l++){const u=l/c,a=r+u*h,f=Math.cos(a)*o,w=Math.sin(s),O=-Math.sin(a)*o;p[3*M]=f*n,p[3*M+1]=w*n,p[3*M+2]=O*n,i[3*M]=f,i[3*M+1]=w,i[3*M+2]=O,g[2*M]=u,g[2*M+1]=e,t.push(M),++M}m.push(t)}const A=new Array;for(let w=0;w<a;w++)for(let t=0;t<c;t++){const n=m[w][t],e=m[w][t+1],s=m[w+1][t+1],o=m[w+1][t];0===w?(A.push(n),A.push(s),A.push(o)):w===a-1?(A.push(n),A.push(e),A.push(s)):(A.push(n),A.push(e),A.push(s),A.push(s),A.push(o),A.push(n))}const I=[[L.POSITION,new P(p,A,3,!0)],[L.NORMAL,new P(i,A,3,!0)]];return o.uv&&I.push([L.UV0,new P(g,A,2,!0)]),o.offset&&(I[0][0]=L.OFFSET,I.push([L.POSITION,new P(Float64Array.from(o.offset),O(A.length),3,!0)])),new S(t,I)}function et(t,n,e,s){const o=st(n,e,s);return new S(t,o)}function st(t,n,e){const s=t;let o,r;if(e)o=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],r=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const t=s*(1+Math.sqrt(5))/2;o=[-s,t,0,s,t,0,-s,-t,0,s,-t,0,0,-s,t,0,s,t,0,-s,-t,0,s,-t,t,0,-s,t,0,s,-t,0,-s,-t,0,s],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<o.length;c+=3)b.scale(o,c,t/b.length(o,c));let h={};function l(n,e){n>e&&([n,e]=[e,n]);const s=n.toString()+"."+e.toString();if(h[s])return h[s];let r=o.length;return o.length+=3,b.add(o,3*n,o,3*e,o,r),b.scale(o,r,t/b.length(o,r)),r/=3,h[s]=r,r}for(let c=0;c<n;c++){const t=r.length,n=new Array(4*t);for(let e=0;e<t;e+=3){const t=r[e],s=r[e+1],o=r[e+2],h=l(t,s),u=l(s,o),c=l(o,t),a=4*e;n[a]=t,n[a+1]=h,n[a+2]=c,n[a+3]=s,n[a+4]=u,n[a+5]=h,n[a+6]=o,n[a+7]=c,n[a+8]=u,n[a+9]=h,n[a+10]=u,n[a+11]=c}r=n,h={}}const u=g(o);for(let c=0;c<u.length;c+=3)b.normalize(u,c);return[[L.POSITION,new P(g(o),r,3,!0)],[L.NORMAL,new P(u,r,3,!0)]]}function ot(t,n,e,s,o,r,h,l,u=null){const c=e?[e[0],e[1],e[2]]:[0,0,0],a=n?[n[0],n[1],n[2]]:[0,0,1];h=h||[0,0];const f=s?[255*s[0],255*s[1],255*s[2],s.length>3?255*s[3]:255]:[255,255,255,255],p=null!=o&&2===o.length?o:[1,1],i=O(1),w=[[L.POSITION,new P(c,i,3,!0)],[L.NORMAL,new P(a,i,3,!0)],[L.UV0,new P(h,i,h.length)],[L.COLOR,new P(f,i,4,!0)],[L.SIZE,new P(p,i,2)]];if(null!=r){const t=[r[0],r[1],r[2],r[3]];w.push([L.AUXPOS1,new P(t,i,4)])}if(null!=l){const t=[l[0],l[1],l[2],l[3]];w.push([L.FEATUREATTRIBUTE,new P(t,i,4)])}return new S(t,w,null,T.Point,u)}const rt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function ht(t,n=rt){const e=new Array(12);for(let c=0;c<4;c++)for(let t=0;t<3;t++)e[3*c+t]=n[c][t];const s=[0,1,2,2,3,0],o=[0,0,1],r=[0,0,0,0,0,0],h=[0,0,1,0,1,1,0,1],l=[255,255,255,255],u=[[L.POSITION,new P(e,s,3,!0)],[L.NORMAL,new P(o,r,3,!0)],[L.UV0,new P(h,s,2,!0)],[L.COLOR,new P(l,r,4,!0)]];return new S(t,u)}function lt(t,n,e,s,o,r=!0,h=!0){let l=0;const u=e,a=n;let f=c(0,l,0),p=c(0,l+a,0),i=c(0,-1,0),g=c(0,1,0);o&&(l=a,p=c(0,0,0),f=c(0,l,0),i=c(0,1,0),g=c(0,-1,0));const O=[p,f],m=[i,g],M=s+2,A=Math.sqrt(a*a+u*u);if(o)for(let w=s-1;w>=0;w--){const t=w*(2*Math.PI/s),n=c(Math.cos(t)*u,l,Math.sin(t)*u);O.push(n);const e=c(a*Math.cos(t)/A,-u/A,a*Math.sin(t)/A);m.push(e)}else for(let w=0;w<s;w++){const t=w*(2*Math.PI/s),n=c(Math.cos(t)*u,l,Math.sin(t)*u);O.push(n);const e=c(a*Math.cos(t)/A,u/A,a*Math.sin(t)/A);m.push(e)}const I=new Array,y=new Array;if(r){for(let t=3;t<O.length;t++)I.push(1),I.push(t-1),I.push(t),y.push(0),y.push(0),y.push(0);I.push(O.length-1),I.push(2),I.push(1),y.push(0),y.push(0),y.push(0)}if(h){for(let t=3;t<O.length;t++)I.push(t),I.push(t-1),I.push(0),y.push(t),y.push(t-1),y.push(1);I.push(0),I.push(2),I.push(O.length-1),y.push(1),y.push(2),y.push(m.length-1)}const N=w(3*M);for(let c=0;c<M;c++)N[3*c]=O[c][0],N[3*c+1]=O[c][1],N[3*c+2]=O[c][2];const T=w(3*M);for(let c=0;c<M;c++)T[3*c]=m[c][0],T[3*c+1]=m[c][1],T[3*c+2]=m[c][2];const R=[[L.POSITION,new P(N,I,3,!0)],[L.NORMAL,new P(T,y,3,!0)]];return new S(t,R)}function ut(t,l,u,p,i,g,O){const m=i?f(i):c(1,0,0),M=g?f(g):c(0,0,0);O??=!0;const A=a();e(A,m);const I=a();s(I,A,Math.abs(l));const y=a();s(y,I,-.5),o(y,y,M);const N=c(0,1,0);Math.abs(1-r(A,N))<.2&&h(N,0,0,1);const T=a();n(T,A,N),e(T,T),n(N,T,A);const R=2*p+(O?2:0),b=p+(O?2:0),j=w(3*R),d=w(3*b),U=w(2*R),V=new Array(3*p*(O?4:2)),v=new Array(3*p*(O?4:2));O&&(j[3*(R-2)]=y[0],j[3*(R-2)+1]=y[1],j[3*(R-2)+2]=y[2],U[2*(R-2)]=0,U[2*(R-2)+1]=0,j[3*(R-1)]=j[3*(R-2)]+I[0],j[3*(R-1)+1]=j[3*(R-2)+1]+I[1],j[3*(R-1)+2]=j[3*(R-2)+2]+I[2],U[2*(R-1)]=1,U[2*(R-1)+1]=1,d[3*(b-2)]=-A[0],d[3*(b-2)+1]=-A[1],d[3*(b-2)+2]=-A[2],d[3*(b-1)]=A[0],d[3*(b-1)+1]=A[1],d[3*(b-1)+2]=A[2]);const x=(t,n,e)=>{V[t]=n,v[t]=e};let E=0;const F=a(),G=a();for(let n=0;n<p;n++){const t=n*(2*Math.PI/p);s(F,N,Math.sin(t)),s(G,T,Math.cos(t)),o(F,F,G),d[3*n]=F[0],d[3*n+1]=F[1],d[3*n+2]=F[2],s(F,F,u),o(F,F,y),j[3*n]=F[0],j[3*n+1]=F[1],j[3*n+2]=F[2],U[2*n]=n/p,U[2*n+1]=0,j[3*(n+p)]=j[3*n]+I[0],j[3*(n+p)+1]=j[3*n+1]+I[1],j[3*(n+p)+2]=j[3*n+2]+I[2],U[2*(n+p)]=n/p,U[2*n+1]=1;const e=(n+1)%p;x(E++,n,n),x(E++,n+p,n),x(E++,e,e),x(E++,e,e),x(E++,n+p,n),x(E++,e+p,e)}if(O){for(let t=0;t<p;t++){const n=(t+1)%p;x(E++,R-2,b-2),x(E++,t,b-2),x(E++,n,b-2)}for(let t=0;t<p;t++){const n=(t+1)%p;x(E++,t+p,b-1),x(E++,R-1,b-1),x(E++,n+p,b-1)}}const C=[[L.POSITION,new P(j,V,3,!0)],[L.NORMAL,new P(d,v,3,!0)],[L.UV0,new P(U,V,2,!0)]];return new S(t,C)}function ct(t,n,e,s,o,r){s=s||10,o=null==o||o,R(n.length>1);const h=[[0,0,0]],l=[],u=[];for(let c=0;c<s;c++){l.push([0,-c-1,-(c+1)%s-1]);const t=c/s*2*Math.PI;u.push([Math.cos(t)*e,Math.sin(t)*e])}return at(t,u,n,h,l,o,r)}function at(r,u,f,i,g,O,m=c(0,0,0)){const N=u.length,T=w(f.length*N*3+(6*i.length||0)),R=w(f.length*N*3+(i?6:0)),b=new Array,j=new Array;let d=0,U=0;const V=a(),v=a(),x=a(),E=a(),F=a(),G=a(),C=a(),k=p(),q=a(),B=a(),z=a(),D=a(),X=a(),Z=M();h(q,0,1,0),t(v,f[1],f[0]),e(v,v),O?(o(k,f[0],m),e(x,k)):h(x,0,0,1),Ot(v,x,q,q,F,x,mt),l(E,x),l(D,F);for(let t=0;t<i.length;t++)s(G,F,i[t][0]),s(k,x,i[t][2]),o(G,G,k),o(G,G,f[0]),T[d++]=G[0],T[d++]=G[1],T[d++]=G[2];R[U++]=-v[0],R[U++]=-v[1],R[U++]=-v[2];for(let t=0;t<g.length;t++)b.push(g[t][0]>0?g[t][0]:-g[t][0]-1+i.length),b.push(g[t][1]>0?g[t][1]:-g[t][1]-1+i.length),b.push(g[t][2]>0?g[t][2]:-g[t][2]-1+i.length),j.push(0),j.push(0),j.push(0);let H=i.length;const J=i.length-1;for(let h=0;h<f.length;h++){let r=!1;if(h>0){l(V,v),h<f.length-1?(t(v,f[h+1],f[h]),e(v,v)):r=!0,o(B,V,v),e(B,B),o(z,f[h-1],E),A(f[h],B,Z);I(Z,y(z,V),k)?(t(k,k,f[h]),e(x,k),n(F,B,x),e(F,F)):Ot(B,E,D,q,F,x,mt),l(E,x),l(D,F)}O&&(o(k,f[h],m),e(X,k));for(let t=0;t<N;t++)if(s(G,F,u[t][0]),s(k,x,u[t][1]),o(G,G,k),e(C,G),R[U++]=C[0],R[U++]=C[1],R[U++]=C[2],o(G,G,f[h]),T[d++]=G[0],T[d++]=G[1],T[d++]=G[2],!r){const n=(t+1)%N;b.push(H+t),b.push(H+N+t),b.push(H+n),b.push(H+n),b.push(H+N+t),b.push(H+N+n);for(let t=0;t<6;t++){const n=b.length-6;j.push(b[n+t]-J)}}H+=N}const K=f[f.length-1];for(let t=0;t<i.length;t++)s(G,F,i[t][0]),s(k,x,i[t][1]),o(G,G,k),o(G,G,K),T[d++]=G[0],T[d++]=G[1],T[d++]=G[2];const Q=U/3;R[U++]=v[0],R[U++]=v[1],R[U++]=v[2];const W=H-N;for(let t=0;t<g.length;t++)b.push(g[t][0]>=0?H+g[t][0]:-g[t][0]-1+W),b.push(g[t][2]>=0?H+g[t][2]:-g[t][2]-1+W),b.push(g[t][1]>=0?H+g[t][1]:-g[t][1]-1+W),j.push(Q),j.push(Q),j.push(Q);const Y=[[L.POSITION,new P(T,b,3,!0)],[L.NORMAL,new P(R,j,3,!0)]];return new S(r,Y)}function ft(t,n,e,s){R(n.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),R(3===n[0].length,"createPolylineGeometry(): malformed vertex"),R(null==e||e.length===n.length,"createPolylineGeometry: need same number of points and normals"),R(null==e||3===e[0].length,"createPolylineGeometry(): malformed normal");const o=i(3*n.length),r=new Array(2*(n.length-1));let h=0,l=0;for(let c=0;c<n.length;c++){for(let t=0;t<3;t++)o[h++]=n[c][t];c>0&&(r[l++]=c-1,r[l++]=c)}const u=[[L.POSITION,new P(o,r,3,!0)]];if(e){const t=w(3*e.length);let s=0;for(let o=0;o<n.length;o++)for(let n=0;n<3;n++)t[s++]=e[o][n];u.push([L.NORMAL,new P(t,r,3,!0)])}return s&&u.push([L.COLOR,new P(s,m(s.length/4),4)]),new S(t,u,null,T.Line)}function pt(t,n,e,s,o,r=0){const h=new Array(18),l=[[-e,r,o/2],[s,r,o/2],[0,n+r,o/2],[-e,r,-o/2],[s,r,-o/2],[0,n+r,-o/2]],u=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)h[3*c]=l[c][0],h[3*c+1]=l[c][1],h[3*c+2]=l[c][2];return new S(t,[[L.POSITION,new P(h,u,3,!0)]])}function it(t,n){const e=t.getMutableAttribute(L.POSITION).data;for(let s=0;s<e.length;s+=3){const t=e[s],o=e[s+1],r=e[s+2];h(Mt,t,o,r),u(Mt,Mt,n),e[s]=Mt[0],e[s+1]=Mt[1],e[s+2]=Mt[2]}}function wt(t,n=t){const e=t.attributes,s=e.get(L.POSITION).data,o=e.get(L.NORMAL).data;if(o){const t=n.getMutableAttribute(L.NORMAL).data;for(let n=0;n<o.length;n+=3){const e=o[n+1];t[n+1]=-o[n+2],t[n+2]=e}}if(s){const t=n.getMutableAttribute(L.POSITION).data;for(let n=0;n<s.length;n+=3){const e=s[n+1];t[n+1]=-s[n+2],t[n+2]=e}}}function gt(t,s,o,h,l){return!(Math.abs(r(s,t))>l)&&(n(o,t,s),e(o,o),n(h,o,t),e(h,h),!0)}function Ot(t,n,e,s,o,r,h){return gt(t,n,o,r,h)||gt(t,e,o,r,h)||gt(t,s,o,r,h)}const mt=.99619469809,Mt=a();export{wt as cgToGIS,E as createBoxGeometry,lt as createConeGeometry,ut as createCylinderGeometry,q as createDiamondGeometry,pt as createExtrudedTriangle,at as createPathExtrusionGeometry,ot as createPointGeometry,st as createPolySphereData,et as createPolySphereGeometry,ft as createPolylineGeometry,nt as createSphereGeometry,ht as createSquareGeometry,tt as createTetrahedronGeometry,ct as createTubeGeometry,Ot as makeOrthoBasisDirUpFallback,it as transformInPlace};
