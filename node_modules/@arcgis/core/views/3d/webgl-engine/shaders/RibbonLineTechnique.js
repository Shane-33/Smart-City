/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{ShaderOutput as e}from"../core/shaderLibrary/ShaderOutput.js";import{ReloadableShaderModule as t}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as i}from"../core/shaderTechnique/ShaderTechnique.js";import{blendingDefault as r,oitBlending as n,oitDepthTest as l,oitDepthWrite as s,OITPolygonOffset as o}from"../lib/OrderIndependentTransparency.js";import{Program as c}from"../lib/Program.js";import{stencilWriteMaskOn as a,stencilToolMaskBaseParams as p,stencilBaseAllZerosParams as u,depthCompareAlways as h,stencilToolTransparentOccluderParams as d,stencilWriteMaskOff as T,stencilToolMaskOccluderParams as f,depthCompareLess as m}from"../lib/StencilUtils.js";import{TransparencyPassType as g}from"../lib/TransparencyPassType.js";import{VertexAttribute as O}from"../lib/VertexAttribute.js";import{R as P}from"../../../../chunks/RibbonLine.glsl.js";import{PrimitiveType as b}from"../../../webgl/enums.js";import{makePipelineState as S,defaultDepthWriteParams as R,defaultColorWriteParams as E}from"../../../webgl/renderState.js";const I=new Map([[O.POSITION,0],[O.SUBDIVISIONFACTOR,1],[O.UV0,2],[O.AUXPOS1,3],[O.AUXPOS2,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7],[O.OBJECTANDLAYERIDCOLOR,8]]);class y extends i{initializeProgram(e){return new c(e.rctx,y.shader.get().build(this.configuration),I)}_makePipelineState(t,i){const c=this.configuration,h=t===g.NONE,d=t===g.FrontFace;return S({blending:c.output===e.Color||c.output===e.Alpha?h?r:n(t):null,depthTest:{func:l(t)},depthWrite:h?c.writeDepth?R:null:s(t),colorWrite:E,stencilWrite:c.hasOccludees?a:null,stencilTest:c.hasOccludees?i?p:u:null,polygonOffset:h||d?c.hasPolygonOffset?A:null:o})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?A:null;this._occluderPipelineTransparent=S({blending:r,polygonOffset:t,depthTest:h,depthWrite:null,colorWrite:E,stencilWrite:null,stencilTest:d}),this._occluderPipelineOpaque=S({blending:r,polygonOffset:t,depthTest:h,depthWrite:null,colorWrite:E,stencilWrite:T,stencilTest:f}),this._occluderPipelineMaskWrite=S({blending:null,polygonOffset:t,depthTest:m,depthWrite:null,colorWrite:null,stencilWrite:a,stencilTest:p})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?b.LINES:b.TRIANGLE_STRIP}getPipeline(e,t,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}y.shader=new t(P,(()=>import("./RibbonLine.glsl.js")));const A={factor:0,units:-4};export{y as RibbonLineTechnique,I as vertexAttributeLocations};
