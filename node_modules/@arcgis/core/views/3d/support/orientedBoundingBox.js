/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{b as e,c as t}from"../../../chunks/mat3.js";import{a as n}from"../../../chunks/mat3f64.js";import{c as a,a as r}from"../../../chunks/quat.js";import{b as i,a as o}from"../../../chunks/quatf64.js";import{c as s,v as f,w as c,x as h,y as u,f as l,u as z,s as S,t as m,g as M,k as b,l as q,i as p,q as j,z as k,A as g}from"../../../chunks/vec3.js";import{g as x,c as v}from"../../../chunks/vec3f64.js";import{t as y}from"../../../chunks/vec4.js";import{c as d}from"../../../chunks/vec4f64.js";import{create as w}from"../../../geometry/support/aaBoundingBox.js";import{signedDistance as A,normal as B}from"../../../geometry/support/plane.js";import{ViewingMode as G}from"../../ViewingMode.js";import{computeOBB as I}from"./dito.js";const V=o(),C=v(),D=v(),E=d(),F=n();function H(e=[0,0,0],t=[-1,-1,-1],n=o()){return{center:x(e),halfSize:x(t),quaternion:i(n)}}function J(e){return H(e.center,e.halfSize,e.quaternion)}function K(e,t){s(t.center,e.center),s(t.halfSize,e.halfSize),a(t.quaternion,e.quaternion)}function L(e,t){return t=t||H(),I(e,t),t}function N(e,t){const n=A(t,e.center),a=Z(e,B(t));return n>a?1:n<-a?-1:0}function O(e,t){return C[0]=e.center[0]-t[0],C[1]=e.center[1]-t[1],C[2]=e.center[2]-t[2],r(V,e.quaternion),f(C,C,V),c(C,C),h(D,C,e.halfSize),u(D,C)<t[3]*t[3]}function P(t,n){n||(n=w());const a=e(F,t.quaternion),r=t.halfSize[0]*Math.abs(a[0])+t.halfSize[1]*Math.abs(a[3])+t.halfSize[2]*Math.abs(a[6]),i=t.halfSize[0]*Math.abs(a[1])+t.halfSize[1]*Math.abs(a[4])+t.halfSize[2]*Math.abs(a[7]),o=t.halfSize[0]*Math.abs(a[2])+t.halfSize[1]*Math.abs(a[5])+t.halfSize[2]*Math.abs(a[8]);return n[0]=t.center[0]-r,n[1]=t.center[1]-i,n[2]=t.center[2]-o,n[3]=t.center[0]+r,n[4]=t.center[1]+i,n[5]=t.center[2]+o,n}function Q(e,t){return A(t,e.center)-Z(e,B(t))}function R(e,t){return A(t,e.center)+Z(e,B(t))}function T(e,t){return N(e,t[0])<=0&&N(e,t[1])<=0&&N(e,t[2])<=0&&N(e,t[3])<=0&&N(e,t[4])<=0&&N(e,t[5])<=0}function U(e,t,n,a=0){r(V,e.quaternion),l(C,t,e.center);const i=f(C,C,V),o=f(D,n,V);let s=-1/0,c=1/0;for(let r=0;r<3;r++)if(Math.abs(o[r])>1e-6){const t=(a+e.halfSize[r]-i[r])/o[r],n=(-a-e.halfSize[r]-i[r])/o[r];s=Math.max(s,Math.min(t,n)),c=Math.min(c,Math.max(t,n))}else if(i[r]>e.halfSize[r]+a||i[r]<-e.halfSize[r]-a)return!1;return s<=c}function W(n,a,i,o,s){r(V,n.quaternion),z(C,a,n.center),f(C,C,V);const c=C[0]<-n.halfSize[0]?-1:C[0]>n.halfSize[0]?1:0,h=C[1]<-n.halfSize[1]?-1:C[1]>n.halfSize[1]?1:0,u=C[2]<-n.halfSize[2]?-1:C[2]>n.halfSize[2]?1:0,l=Math.abs(c)+Math.abs(h)+Math.abs(u);if(0===l)return 1/0;const b=1===l?4:6,q=6*(c+3*h+9*u+13);e(F,n.quaternion),t(F,F,n.halfSize);for(let e=0;e<b;e++){const t=Y[q+e];S(C,((1&t)<<1)-1,(2&t)-1,((4&t)>>1)-1),m(C,C,F),M(E,n.center,C),E[3]=1,y(E,E,i);const a=1/Math.max(1e-6,E[3]);X[2*e]=E[0]*a,X[2*e+1]=E[1]*a}const p=2*b-2;let j=X[0]*(X[3]-X[p+1])+X[p]*(X[1]-X[p-1]);for(let e=2;e<p;e+=2)j+=X[e]*(X[e+3]-X[e-1]);return Math.abs(j)*o*s*.125}const X=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Y=(()=>{const e=new Int8Array(162);let t=0;const n=n=>{for(let a=0;a<n.length;a++)e[t+a]=n[a];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function Z(e,t){r(V,e.quaternion),f(C,t,V);const n=e.halfSize;return Math.abs(C[0]*n[0])+Math.abs(C[1]*n[1])+Math.abs(C[2]*n[2])}function $(e,t){for(let n=0;n<8;++n){const a=t[n];a[0]=1&n?-e.halfSize[0]:e.halfSize[0],a[1]=2&n?-e.halfSize[1]:e.halfSize[1],a[2]=4&n?-e.halfSize[2]:e.halfSize[2],f(a,a,e.quaternion),M(a,a,e.center)}}function _(e){return b(e.halfSize)}function ee(e,t,n,i,o){if(a(o.quaternion,e.quaternion),i===G.Global){r(re,e.quaternion),f(te,e.center,re),c(ne,te),h(ae,ne,e.halfSize),z(ae,ne,ae);const a=q(ae);M(ae,ne,e.halfSize);const i=q(ae);if(a<n)s(o.center,e.center),S(te,n,n,n),M(o.halfSize,e.halfSize,te);else{const r=i>0?1+t/i:1,s=a>0?1+n/a:1,c=(s+r)/2,h=(s-r)/2;p(o.halfSize,ne,h),j(o.halfSize,o.halfSize,e.halfSize,c),p(o.center,ne,c),j(o.center,o.center,e.halfSize,h),k(te,te),g(o.center,o.center,te),f(o.center,o.center,o.quaternion)}}else{const a=S(te,0,0,1);j(o.center,e.center,a,(n+t)/2),r(re,e.quaternion),f(a,a,re),c(a,a),j(o.halfSize,e.halfSize,a,(n-t)/2)}return o}const te=v(),ne=v(),ae=v(),re=o();export{J as clone,L as compute,ee as computeOffsetObb,$ as corners,H as create,U as intersectLine,N as intersectPlane,O as intersectSphere,T as isVisible,R as maximumDistancePlane,Q as minimumDistancePlane,W as projectedArea,Z as projectedRadius,_ as radius,K as set,P as toAaBoundingBox};
