/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{a as t}from"../../../../chunks/mat4f64.js";import{s as o}from"../../../../chunks/vec2.js";import{a as s}from"../../../../chunks/vec2f64.js";import{s as r,j as n,f as e,i as m,g as a,c as i,q as c,n as I,b as f}from"../../../../chunks/vec3.js";import{c as l}from"../../../../chunks/vec3f64.js";import{getReferenceEllipsoid as h}from"../../../../geometry/ellipsoidUtils.js";import{lonLatToWebMercatorComparable as p}from"../../../../geometry/projection/projectors.js";import{newDoubleArray as u}from"../../../../geometry/support/DoubleArray.js";import{create as N,fromArray as g,normal as j}from"../../../../geometry/support/plane.js";import{ViewingMode as b}from"../../../ViewingMode.js";function T(t,s,r,n,e=1){if(r.isGeographic&&n===b.Global){const t=u(s.length),o=s.length,n=h(r);for(let r=0;r<o;r+=3)p(s,r,t,r,n);s=t}o(y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<s.length;o+=3)y[0]=Math.min(y[0],s[o]),y[1]=Math.min(y[1],s[o+1]);const m=y[0]%e,a=y[1]%e,i=y[0]-m,c=y[1]-a;for(let o=0;o<s.length;o+=3){const r=o/3*4;t[r]=(s[o]-i)/e,t[r+1]=(s[o+1]-c)/e,t[r+2]=i/e,t[r+3]=c/e}}function M(t,s,i,c,I=1){r(Y,1,0,0),r(_,0,1,0),r(k,0,0,1),w(E,i),g(F,i)&&G(F,Y,_,k,c,E),o(y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o(P,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let o=0;o<i.length;o+=3){r(V,i[o],i[o+1],i[o+2]);const t=n(Y,V),s=n(_,V);y[0]=Math.min(y[0],t),y[1]=Math.min(y[1],s),P[0]=Math.max(P[0],t),P[1]=Math.max(P[1],s)}const f=n(k,E);U(v,y[0],y[1],f,Y,_,k),U(x,P[0],y[1],f,Y,_,k),U(A,y[0],P[1],f,Y,_,k),e(x,x,v),m(x,x,.5),e(A,A,v),m(A,A,.5),a(v,v,x),a(v,v,A);const l=y[0]%I,h=y[1]%I,p=y[0]-l,u=y[1]-h;for(let o=0;o<i.length;o+=3){r(V,i[o],i[o+1],i[o+2]);const e=o/3,m=4*e;t[m]=(n(Y,V)-p)/I,t[m+1]=(n(_,V)-u)/I,t[m+2]=p/I,t[m+3]=u/I;const a=9*e;for(let t=0;t<3;t++)s[a+t]=v[t],s[a+t+3]=x[t],s[a+t+6]=A[t]}}const E=l(),V=l(),F=N(),Y=l(),_=l(),k=l(),y=s(),P=s(),v=l(),x=l(),A=l();function G(t,o,s,e,a,l){null!=a?(a.basisMatrixAtPosition(l,O),r(S,O[0],O[1],O[2]),r(d,O[4],O[5],O[6]),r(q,O[8],O[9],O[10])):(r(S,1,0,0),r(d,0,1,0),r(q,0,0,1));const h=j(t);n(h,q)<0&&m(h,h,-1),i(e,h);const p=n(h,d),u=n(h,S);Math.abs(p)>Math.abs(u)?(c(o,S,h,-u),I(o,o),f(s,o,h),I(s,s),m(s,s,-1)):(c(s,d,h,-p),I(s,s),f(o,s,h),I(o,o))}const O=t(),S=l(),d=l(),q=l();function w(t,o){r(D,0,0,0);for(let s=0;s<o.length-3;s+=3)D[0]+=o[s],D[1]+=o[s+1],D[2]+=o[s+2];m(t,D,1/(o.length/3-1))}const D=l();function U(t,o,s,n,e,m,a){r(t,o*e[0]+s*m[0]+n*a[0],o*e[1]+s*m[1]+n*a[1],o*e[2]+s*m[2]+n*a[2])}export{M as createMapSpaceUVCoords,T as createMapSpaceUVCoordsDraped};
