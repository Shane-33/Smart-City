/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{max as s}from"../../../../../core/quantityUtils.js";import{getMetersPerCartesianUnitForSR as t,getMetersPerUnitForSR as o}from"../../../../../core/unitUtils.js";import{a as i}from"../../../../../chunks/vec2.js";import{g as e,f as n,p as a,b as r,n as c,i as l,j as p,l as u,q as g}from"../../../../../chunks/vec3.js";import{a as d,c as m,u as h}from"../../../../../chunks/boundedPlane.js";import{sv3d as b}from"../../../../../geometry/support/vectorStacks.js";import{getGraphicEffectiveElevationInfo as f}from"../../../../../support/elevationInfoUtils.js";import{mainAxis as y}from"../geometryUtils.js";import{evaluateElevationAlignmentAtPoint as B}from"../../../layers/graphics/elevationAlignmentUtils.js";import{ElevationContext as j}from"../../../layers/graphics/ElevationContext.js";import{calculateOrientedBounds as v}from"../../../../interactive/editGeometry/support/editPlaneUtils.js";import{autoHorizontalDistanceByElevationMode as C}from"../../../../support/automaticLengthMeasurementUtils.js";class _{constructor(s,t,o){this._tool=s,this._onDisplayBoundsChanged=t,this.mapBounds=d(),this.mapBoundsStart=d(),this.displayBounds=d(),this._calculateMapBounds(o)}get displayBoundsMargin(){const{view:s,graphic:t}=this._tool,o=s.pointsOfInterest?.centerOnSurfaceFrequent.location??t.geometry?.extent?.center;return o?R*s.pixelSizeAt(o):0}backupMapBounds(){m(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged()}_calculateMapBounds(s){const{view:e,attachmentOrigin:n}=this._tool,a=s.geometry,r=y(a);i(r,r,-1);const c=e.spatialReference,l=a.spatialReference,p=n?e.pixelSizeAt(n)*t(c)/o(l):0;v(r,s,U*p,this.mapBounds)}_calculateDisplayBounds(){const{view:s,attachmentOrigin:t,graphic:o}=this._tool;if(!o.geometry)return;const i=t?.z??B(this.mapBounds.origin,s.elevationProvider,j.fromElevationInfo(f(o)),s.renderCoordsHelper),e=m(this.mapBounds);e.origin[2]=i??0,M(e,s.renderCoordsHelper,o.geometry.spatialReference,this.displayBoundsMargin,this.displayBounds)}}const R=10,U=80;function M(s,t,o,i=0,g){g||(g=d()),t.toRenderCoords(s.origin,o,g.origin);const m=b.get();e(m,s.origin,s.basis1),e(m,m,s.basis2),t.toRenderCoords(m,o,m);const f=b.get();e(f,s.origin,s.basis1),n(f,f,s.basis2),t.toRenderCoords(f,o,f);const y=b.get();n(y,s.origin,s.basis1),n(y,y,s.basis2),t.toRenderCoords(y,o,y);const B=b.get();n(B,s.origin,s.basis1),e(B,B,s.basis2),t.toRenderCoords(B,o,B);const j=a(b.get(),m,f,.5);n(j,j,g.origin);const v=a(b.get(),y,B,.5);n(v,g.origin,v),a(g.basis1,j,v,.5);const C=a(b.get(),B,m,.5);n(C,C,g.origin);const _=a(b.get(),f,y,.5);n(_,g.origin,_),a(g.basis2,C,_,.5);const R=r(b.get(),g.basis1,g.basis2),U=r(R,R,g.basis1);return c(U,U),l(g.basis2,U,p(g.basis2,U)),l(g.basis1,g.basis1,1+i/u(g.basis1)),l(g.basis2,g.basis2,1+i/u(g.basis2)),h(g),g}function S(t,o,i,e){const a=b.get();n(a,n(a,t.origin,t.basis1),t.basis2);const r=b.get();g(r,a,t.basis1,2);const c=b.get();g(c,r,t.basis2,2);const l=b.get();g(l,a,t.basis2,2),a[2]=r[2]=c[2]=l[2]=o;const p=e?"on-the-ground":"absolute-height",u=s(C(a,r,i,p),C(l,c,i,p)),d=s(C(r,c,i,p),C(a,l,i,p));return null==d||null==u?null:[u,d]}export{_ as TransformBounds,S as mapPlaneAutoHorizontalSizeByElevationMode};
