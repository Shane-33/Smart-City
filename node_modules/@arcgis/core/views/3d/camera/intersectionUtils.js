/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{c as e,a as r,i as n,f as t,g as i,j as o,l as s}from"../../../chunks/vec3.js";import{c as a}from"../../../chunks/vec3f64.js";import{getReferenceEllipsoid as c}from"../../../geometry/ellipsoidUtils.js";import{containsPoint as l}from"../../../geometry/support/aaBoundingRect.js";import{newIntersector as d}from"../webgl-engine/lib/Intersector.js";function u(e,r,n,t){return null!=e.renderCoordsHelper.fromRenderCoords(r.eye,M,t)&&l(n,M)}function f(e,r){return e.elevationProvider?e.elevationProvider.getElevation(r[0],r[1],r[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function g(o,s,a,c){const l=o.state.camera.clone();s&&a&&c&&(l.eye=s,l.center=a,l.up=c),m(o,l.ray,b)||e(b,l.center);const d=o.state.constraints,u=d.minimumPoiDistance;if(r(l.eye,b)<u){const r=d.collision.enabled;e(j,l.viewForward),n(j,j,u),r?l.eye=t(M,b,j):i(b,l.eye,j);const s=o.renderCoordsHelper,a=s.getAltitude(l.eye),c=d.collision.elevationMargin;r&&a<c&&(t(j,b,l.eye),l.eye=s.setAltitude(M,c,l.eye),i(b,l.eye,j))}return l.center=b,l}function p(e,n,t){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const i=f(e,n),o=e.stateManager.constraintsManager.nearFarHeuristic,{far:s}=o.compute(n,t,e.renderDataExtent,i,w),a=s*s;return r(n,t)>a}function m(e,r,n){let t=v[e.viewingMode];t||(t=d(e.state.viewingMode),t.options.backfacesTerrain=!e.state.isGlobal,t.options.invisibleTerrain=!0,v[e.viewingMode]=t);const{isGlobal:i}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(r,t,n)||p(e,r.origin,n))||(!(!e.renderCoordsHelper.intersectManifold(r,0,n)||p(e,r.origin,n))||!!i&&y(r,n,c(e.spatialReference).radius))}function y(e,r,t){const a=o(e.origin,e.origin)-t*t,c=a>0?Math.sqrt(a)/3:1;return n(r,e.direction,c/s(e.direction)),i(r,r,e.origin),!0}const v={},M=a(),b=a(),j=a(),w={near:0,far:0};export{g as cameraOnContentAlongViewDirection,u as eyeWithinExtent,f as surfaceElevationBelowRenderLocation};
