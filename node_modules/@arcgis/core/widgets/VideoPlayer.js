/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{clone as i}from"../core/lang.js";import{watch as t,initial as r}from"../core/reactiveUtils.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/accessorSupport/ensureType.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import{formatDate as n}from"../intl/date.js";import l from"../views/VideoView.js";import a from"./Slider.js";import d from"./Widget.js";import{loadCalciteComponents as c}from"./support/componentsUtils.js";import"./support/widgetUtils.js";import{tsx as p}from"./support/jsxFactory.js";import m from"./VideoPlayer/VideoPlayerViewModel.js";import{loadMetadataSectionComponents as u,MetadataSection as h}from"./VideoPlayer/components/MetadataSection.js";import{loadPlayerActionsGroupComponents as v,PlayerActionsGroup as w}from"./VideoPlayer/components/PlayerActionsGroup.js";import{loadPlayerControlsGroupComponents as g,PlayerControlsGroup as y}from"./VideoPlayer/components/PlayerControlsGroup.js";import{defaultSettings as f}from"./VideoPlayer/components/SettingsButton.js";const M="esri-video-player",j={widget:"esri-widget",sliderProgressContainer:"esri-slider-progress-container",progress:"esri-progress",slider:"esri-slider",rangeSlider:"esri-range-slider",videoView:"esri-video-view"};let V=class extends d{constructor(e,t){super(e,t),this._settings=i(f),this._metadataVisible=!1,this._slider=new a({visibleElements:{labels:!1,rangeLabels:!1},min:0,max:100,values:[0],thumbsConstrained:!1}),this.videoView=new l({container:document.createElement("div")}),this.viewModel=new m}initialize(){this.addHandles([t((()=>this.viewModel.layer),(()=>{this.videoView.layer=this.viewModel.layer}),r),this._slider.on(["thumb-change","thumb-drag"],(({value:e})=>{const i=e*this.viewModel.duration/100;this.viewModel.seekTo(i)}))])}loadDependencies(){return Promise.all([c({"action-bar":()=>import("@esri/calcite-components/dist/components/calcite-action-bar.js"),progress:()=>import("@esri/calcite-components/dist/components/calcite-progress.js"),shell:()=>import("@esri/calcite-components/dist/components/calcite-shell.js"),panel:()=>import("@esri/calcite-components/dist/components/calcite-panel.js"),scrim:()=>import("@esri/calcite-components/dist/components/calcite-scrim.js")}),v(),g(),u()])}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return p("calcite-shell",{class:this.classes(M,j.widget)},p("calcite-panel",{heading:this.layer?.title||"Video Player"},this._renderLoadingScrim(),this._renderBuffering(),this._renderVideoSection(),this._renderActionBar(),this._renderMetadataSection()))}_renderLoadingScrim(){const{state:e}=this.viewModel;return this.videoView.ready?null:p("calcite-scrim",{loading:"error"!==e},"error"===e?"Error loading the layer":null)}_renderBuffering(){const{currentTime:e,buffered:i,duration:t}=this.viewModel,r=i/(t||1),s=e/(t||1);return this.viewModel.ended||r>s?null:p("calcite-progress",{type:"indeterminate"})}_renderVideoSection(){const{buffered:e,currentTime:i,duration:t}=this.viewModel,r=this.videoView.container;if(!r)return null;r.className=j.videoView;const s=e/(t||1),o=i/(t||1);return this._slider.values=[100*o],p("section",{afterCreate:b,bind:r},p("div",{class:j.sliderProgressContainer},p("progress",{class:j.progress,max:"1",value:`${s}`}),p("div",{class:j.slider},this._slider.render())))}_renderActionBar(){return p("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",styles:{padding:"5px"}},p(w,{viewModel:this.viewModel}),p("div",{styles:{display:"flex",alignItems:"center",padding:"5px"}},_(this.viewModel.currentTime)," / ",_(this.viewModel.duration)),p(y,{settings:this._settings,toggleMetadata:()=>this._metadataVisible=!this._metadataVisible,viewModel:this.viewModel}))}_renderMetadataSection(){return this._metadataVisible?p(h,{viewModel:this.viewModel}):null}};function _(e){return n(1e3*Math.round(e),{minute:"2-digit",second:"2-digit"})}function b(e){const i=this;e.prepend(i)}e([s()],V.prototype,"_settings",void 0),e([s()],V.prototype,"layer",null),e([s()],V.prototype,"videoView",void 0),e([s({type:m})],V.prototype,"viewModel",void 0),e([s()],V.prototype,"view",null),V=e([o("esri.widgets.VideoPlayer")],V);const P=V;export{P as default};
