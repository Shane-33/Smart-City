/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../core/Collection.js";import{on as a,eventKey as i}from"../core/events.js";import{clone as s}from"../core/lang.js";import n from"../core/Logger.js";import{watch as o,initial as l}from"../core/reactiveUtils.js";import{addProxy as r,hasSameOrigin as p}from"../core/urlUtils.js";import{property as d}from"../core/accessorSupport/decorators/property.js";import"../core/accessorSupport/ensureType.js";import{subclass as c}from"../core/accessorSupport/decorators/subclass.js";import{getToken as u}from"../rest/utils.js";import h from"./Widget.js";import m from"./Print/FileLink.js";import _ from"./Print/PrintViewModel.js";import b from"./Print/TemplateOptions.js";import{globalCss as v}from"./support/globalCss.js";import{Heading as y}from"./support/Heading.js";import{legacyIcon as f}from"./support/legacyIcon.js";import g from"./support/Popover.js";import{isActivationKey as T,keepMenuItemWithinView as w}from"./support/widgetUtils.js";import{messageBundle as O}from"./support/decorators/messageBundle.js";import{tsx as x}from"./support/jsxFactory.js";const C=t.ofType(m),L="MAP_ONLY";var I;!function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab"}(I||(I={}));const k="esri-print",S=`${k}__advanced-options-button`,$={base:k,widgetIcon:f.printer,headerTitle:`${k}__header-title`,inputText:`${k}__input-text`,layoutTabList:`${k}__layout-tab-list`,layoutTab:`${k}__layout-tab`,layoutSection:`${k}__layout-section`,mapOnlySection:`${k}__map-only-section`,scaleInput:`${k}__scale-input`,templateList:`${k}__template-list`,templateListScroller:`${k}__template-list-scroller`,templateListFooter:`${k}__template-list-footer`,loader:`${k}__loader`,advancedOptionsButton:S,advancedOptionsButtonContainer:`${S}-container`,advancedOptionsButtonTitle:`${S}-title`,advancedOptionsButtonIconOpened:`${S}-icon--opened`,advancedOptionsButtonIconClosed:`${S}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${S}-icon--closed-rtl`,refreshButton:`${k}__refresh-button`,swapButton:`${k}__swap-button`,linkButton:`${k}__link-button`,printButton:`${k}__export-button`,templateButton:`${k}__template-button`,formSectionContainer:`${k}__form-section-container`,advancedOptionsSection:`${k}__advanced-options-section`,advancedOptionsContainer:`${k}__advanced-options-container`,authorInfoContainer:`${k}__author-info-container`,copyrightInfoContainer:`${k}__copyright-info-container`,exportedFilesContainer:`${k}__export-panel-container`,exportedFilesTitle:`${k}__export-title`,exportedFile:`${k}__exported-file`,exportedFileLink:`${k}__exported-file-link`,exportedFileLinkTitle:`${k}__exported-file-link-title`,heightContainer:`${k}__height-container`,legendInfoContainer:`${k}__legend-info-container`,printWidgetContainer:`${k}__container`,panelContainer:`${k}__panel-container`,scaleInfoContainer:`${k}__scale-info-container`,scaleInputContainer:`${k}__scale-input-container`,sizeContainer:`${k}__size-container`,widthContainer:`${k}__width-container`,panelError:`${k}__panel--error`,exportedFileError:`${k}__exported-file--error`},M="User sets an invalid layout, resetting it to the default valid one...",F="User sets an invalid format, resetting it to the default valid one...";function E(e){const t=8.3333,a=11.4583;return{width:Math.round(e*t),height:Math.round(e*a)}}function P(e){return!isNaN(e)&&e>0}function V(e){return e?.toUpperCase()===L}let A=class extends h{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._focusedTemplateIndex=0,this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this._selectTemplateNode=null,this._templateListPopover=new g({owner:this,placement:"top",offset:[0,-100],anchorElement:()=>this._selectTemplateNode,renderContentFunction:this._renderTemplateList}),this.exportedLinks=new C,this.headingLevel=3,this.iconClass=$.widgetIcon,this.icon=null,this.templateOptions=new b,this.viewModel=new _,this._handleTemplateListCreation=e=>e.focus(),this._handleTemplateChildBlur=e=>{const t=e.relatedTarget?.closest(`.${$.templateList}`);t||this._handleCloseTemplateSelection()},this._handleCloseTemplateSelection=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!1,this._selectTemplateNode?.focus()},this._handleSelectTemplateClick=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!0},this._handleTemplateListClick=e=>{const t=B(e.target);t&&this._applyTemplate(t)},this._handleTemplateListKeyDown=e=>{if(this._focusedTemplateIndex){if(T(e.key))return this._applyTemplate(this.viewModel.defaultTemplates.at(this._focusedTemplateIndex)),void e.preventDefault();if("ArrowDown"===e.key||"ArrowUp"===e.key){const{defaultTemplates:t}=this.viewModel,a="ArrowDown"===e.key?1:-1,i=(this._focusedTemplateIndex+a)%t.length;this._focusedTemplateIndex=i<0?t.length-1:i;const s=e.currentTarget;w(s.querySelectorAll(`.${v.menuItem}`)[this._focusedTemplateIndex],s.parentElement),e.preventDefault()}"Escape"===e.key&&this._handleCloseTemplateSelection()}},this._removeLink=e=>{const t=e.currentTarget["data-item"];t&&"error"===t.state&&this.exportedLinks.remove(t)},this._handleLinkClick=e=>{const t=e.currentTarget,{href:a}=t,i=u(this.viewModel.effectivePrintServiceUrl);if(!i)return;if(!e.isTrusted)return void e.stopPropagation();e.preventDefault();const s=new URL(a);s.searchParams.set("token",i),t.href=s.href,t.click(),t.href=a},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([o((()=>this.viewModel?.templatesInfo),(e=>{const{format:t,layout:a}=this.templateOptions;if(e){const i=a===e.layout.defaultValue||V(a)||e.layout.choiceList&&a&&e.layout.choiceList.includes(a),s=t===e.format.defaultValue||e.format.choiceList&&t&&e.format.choiceList.includes(t);i||(a&&n.getLogger(this).warn(M),this.templateOptions.layout=e.layout.defaultValue),s||(t&&n.getLogger(this).warn(F),this.templateOptions.format=e.format.defaultValue),V(a)&&(this._layoutTabSelected=!1)}}),l),o((()=>this.templateOptions?.format),(e=>{const{viewModel:{templatesInfo:t}}=this;if(t&&e){let a=!1;t.format.choiceList&&t.format.choiceList.forEach((t=>{t.toUpperCase()===e.toUpperCase()&&(this.templateOptions.format=t,a=!0)})),a||(this.templateOptions.format=t.format.defaultValue,n.getLogger(this).warn(F)),this.scheduleRender()}}),l),o((()=>this.templateOptions?.layout),(e=>{const{viewModel:{templatesInfo:t}}=this;if(t&&e){this._layoutTabSelected=!V(e);let a=!this._layoutTabSelected;a||t.layout.choiceList&&t.layout.choiceList.forEach((t=>{t.toUpperCase()===e.toUpperCase()&&(this.templateOptions.layout=t,a=!0)})),a||(this.templateOptions.layout=t.layout.defaultValue,n.getLogger(this).warn(M));const i=this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=i?s(i):null,this.scheduleRender()}}),l),o((()=>this.templateOptions?.dpi),(e=>{e<=0?this.templateOptions.dpi=1:this.scheduleRender()}),l),o((()=>this.viewModel?.view?.scale),(e=>{const{scale:t,scaleEnabled:a}=this.templateOptions;a&&t||(this.templateOptions.scale=e)}),l)]);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const a=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender()}),500);this.viewModel.load().then((()=>clearTimeout(a)))}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{attributionEnabled:e,author:t,copyright:a,dpi:i,format:s,height:n,layout:o,legendEnabled:l,northArrowEnabled:r,scaleEnabled:p,scale:d,width:c}=this.templateOptions,u="ready"!==this.viewModel?.state,h=this._renderTitleOrFileNameSection(),{includeDefaultTemplates:m,messages:_,viewModel:b}=this,g=this.viewModel?.templatesInfo?.format?.choiceList||[],T=g.length>0?g.map((e=>x("option",{key:e,selected:e===s,value:e},e.toUpperCase()))):x("option",{key:"format-default-option"},_.formatDefaultOption),w=x("div",{class:$.formSectionContainer},x("label",null,_.fileFormatTitle,x("select",{bind:this,class:v.select,"data-target-property":"format",onchange:this._updateFromOption},T))),O=this.viewModel?.templatesInfo?.layout?.choiceList,C=O?.length?O.map((e=>x("option",{key:e,selected:e===o,value:e},_[e]||e))):x("option",{key:"layout-default-option"},_.layoutDefaultOption),L=x("div",{class:$.formSectionContainer},x("label",null,_.layoutTitle,x("select",{bind:this,class:v.select,"data-target-property":"layout",onchange:this._updateFromOption},C))),k=x("div",{class:$.formSectionContainer},x("label",null,_.dpi,x("input",{bind:this,class:this.classes($.inputText,v.input),"data-input-name":"dpi",min:"1",onchange:this._handleDPIChange,tabIndex:0,type:"number",value:`${i}`}))),S=x("div",{class:this.classes($.scaleInfoContainer,$.formSectionContainer)},x("label",null,x("input",{bind:this,checked:p,"data-option-name":"scaleEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),_.scale),x("div",{class:$.scaleInputContainer},x("input",{"aria-label":_.scaleLabel,"aria-valuenow":`${d}`,bind:this,class:this.classes($.inputText,v.input,$.scaleInput),"data-input-name":"scale",disabled:!p,onchange:this._updateInputValue,role:"spinbutton",tabIndex:0,type:"number",value:`${d}`}),x("button",{"aria-label":_.reset,bind:this,class:this.classes(v.widgetButton,$.refreshButton,f.refresh),onclick:this._resetToCurrentScale,tabIndex:0,type:"button"}))),M=this._advancedOptionsVisibleForLayout?x("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:$.advancedOptionsContainer},S,x("div",{class:this.classes($.authorInfoContainer,$.formSectionContainer)},x("label",null,_.author,x("input",{bind:this,class:this.classes($.inputText,v.input),"data-input-name":"author",onchange:this._updateInputValue,tabIndex:0,type:"text",value:t??""}))),x("div",{class:this.classes($.copyrightInfoContainer,$.formSectionContainer)},x("label",null,_.copyright,x("input",{bind:this,class:this.classes($.inputText,v.input),"data-input-name":"copyright",onchange:this._updateInputValue,tabIndex:0,type:"text",value:a??""}))),k,x("div",{class:this.classes($.legendInfoContainer,$.formSectionContainer)},x("label",null,x("input",{bind:this,checked:l,"data-option-name":"legendEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),_.legend)),this.viewModel.templateToNorthArrowInfo[o]?x("div",{class:this.classes($.legendInfoContainer,$.formSectionContainer),key:"north-arrow"},x("label",null,x("input",{bind:this,checked:r,"data-option-name":"northArrowEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),_.northArrow)):null,this._renderCustomTextElementSection()):null,F=this._advancedOptionsVisibleForMapOnly?x("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:$.advancedOptionsContainer},S,k,x("div",{class:$.formSectionContainer},x("label",null,x("input",{bind:this,checked:e,"data-option-name":"attributionEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),_.attribution)),this._renderCustomTextElementSection()):null,E=this._layoutTabSelected?x("section",{"aria-labelledby":`${this.id}__layoutTab`,class:$.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},x("div",{class:$.panelContainer},h,L,this._layoutTabSelected?w:null),x("div",{class:this.classes($.panelContainer,$.advancedOptionsSection)},x("button",{"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false","aria-label":_.advancedOptions,bind:this,class:$.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},x("div",{class:$.advancedOptionsButtonContainer},x("span",{"aria-hidden":"true",class:this.classes(f.rightTriangleArrow,$.advancedOptionsButtonIconClosed)}),x("span",{"aria-hidden":"true",class:this.classes(f.leftTriangleArrow,$.advancedOptionsButtonIconClosed_RTL)}),x("span",{"aria-hidden":"true",class:this.classes(f.downArrow,$.advancedOptionsButtonIconOpened)}),x("span",{class:$.advancedOptionsButtonTitle},_.advancedOptions))),M)):x("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:$.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},x("div",{class:$.panelContainer},h,this._layoutTabSelected?null:w,x("div",{class:this.classes($.sizeContainer,$.formSectionContainer)},x("div",{class:$.widthContainer},x("label",null,_.width,x("input",{bind:this,class:this.classes($.inputText,v.input),"data-input-name":"width",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${c}`}))),x("div",{class:$.heightContainer},x("label",null,_.height,x("input",{bind:this,class:this.classes($.inputText,v.input),"data-input-name":"height",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${n}`}))),x("button",{"aria-label":_.swap,bind:this,class:this.classes(v.widgetButton,$.swapButton,f.swap),onclick:this._switchInput,tabIndex:0,type:"button"})),x("div",{class:this.classes($.panelContainer,$.advancedOptionsSection)},x("button",{"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false","aria-label":_.advancedOptions,bind:this,class:$.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},x("div",{class:$.advancedOptionsButtonContainer},x("span",{"aria-hidden":"true",class:this.classes(f.rightTriangleArrow,$.advancedOptionsButtonIconClosed)}),x("span",{"aria-hidden":"true",class:this.classes(f.leftTriangleArrow,$.advancedOptionsButtonIconClosed_RTL)}),x("span",{"aria-hidden":"true",class:this.classes(f.downArrow,$.advancedOptionsButtonIconOpened)}),x("span",{class:$.advancedOptionsButtonTitle},_.advancedOptions))),F))),P=this.exportedLinks.toArray(),V=this._renderExportedLink(P),A={[v.buttonDisabled]:u||!o&&!s},{view:B}=this,D=!B||"2d"!==B.type,N=x("div",{class:$.panelError},D?_.sceneViewError:_.serviceError),j=x("div",null,x("ul",{bind:this,class:$.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},x("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._layoutTabSelected}`,class:$.layoutTab,"data-tab-id":I.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},_.layoutTab),x("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${!this._layoutTabSelected}`,class:$.layoutTab,"data-tab-id":I.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},_.mapOnlyTab)),E,x("button",{"aria-label":_.exportDescription,bind:this,class:this.classes($.printButton,v.button,A),disabled:u,onclick:this._handlePrintMap,tabIndex:0,type:"button"},_.export),m&&b.defaultTemplates.length>0?this._renderTemplateSectionTrigger():null,x("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:$.exportedFilesContainer},x(y,{class:$.exportedFilesTitle,level:this.headingLevel},_.exportText),P.length>0?null:x("div",null,x("div",null,_.exportHint)),V)),U=x("div",{class:$.printWidgetContainer},x("header",{class:$.headerTitle},_.export),this.error||D||!this.view?N:j),R="initializing"===this.viewModel?.state?this._renderLoader():U;return x("div",{afterCreate:this._handleRootAfterCreate,bind:this,class:this.classes($.base,v.widget,v.panel)},R)}_renderTemplateSectionTrigger(){const{messages:e,_templateListPopover:t}=this,a=t.open;return x("button",{afterCreate:e=>this._selectTemplateNode=e,"aria-controls":a?`${this.id}__template-selection`:"","aria-label":e.selectTemplateDescription,"aria-pressed":a.toString(),class:this.classes(v.button,v.buttonTertiary,$.templateButton),onclick:this._handleSelectTemplateClick,title:e.selectTemplateDescription,type:"button"},e.selectTemplate)}_renderCustomTextElementSection(){const{templateOptions:{customTextElements:e}}=this;return e?x("div",{class:$.formSectionContainer,key:"custom-text-elements"},e.map((e=>{const[t,a]=Object.entries(e)[0];return"date"===t?null:x("label",{key:t},t,x("input",{bind:this,class:this.classes($.inputText,v.input),"data-input-custom":!0,"data-input-name":t,onchange:this._updateInputValue,type:"text",value:a}))}))):null}_renderTemplateList(){const{messages:e,messagesCommon:t,viewModel:a}=this,{defaultTemplates:i}=a,s=e.selectTemplateDescription,n=`${this.id}__template-selection`;return x("div",{class:this.classes($.templateList,v.widget,v.panel),id:n},x(y,{class:v.menuHeader,level:this.headingLevel},e.selectTemplate),x("div",{class:$.templateListScroller},x("ul",{afterCreate:this._handleTemplateListCreation,"aria-activedescendant":`${this.id}__template-item--${this._focusedTemplateIndex}`,"aria-label":s,class:v.menuList,key:"templates",onblur:this._handleTemplateChildBlur,onclick:this._handleTemplateListClick,onkeydown:this._handleTemplateListKeyDown,role:"listbox",tabIndex:0,title:s},i.toArray().map(((t,a)=>{const i=a===this._focusedTemplateIndex,s=t.description??"",n=t.label??"";return x("li",{"aria-label":s,class:this.classes(v.menuItem,{[v.menuItemFocus]:i}),"data-template":t,id:`${this.id}__template-item--${a}`,key:n,title:s},V(n)?e.mapOnlyTab:n)})))),x("div",{class:$.templateListFooter},x("button",{class:this.classes(v.button,v.buttonSecondary),onblur:this._handleTemplateChildBlur,onclick:this._handleCloseTemplateSelection,type:"button"},t.done)))}_applyTemplate(e){const{format:t,layout:a,layoutOptions:i}=e,{templateOptions:s}=this;this._templateListPopover.open=!1,this._toggleTab("map-only"===a?I.mapOnly:I.layout,!1),t&&(s.format=t),a&&(s.layout=a),this._focusedTemplateIndex=null,s.legendEnabled=i?.legend??s.legendEnabled,this._handleCloseTemplateSelection()}_renderTitleOrFileNameSection(){const{templateOptions:e,messages:t}=this;let a,i,s,n;return this._layoutTabSelected?(a=t.title,i=t.titlePlaceHolder,s=e.title,n="title"):(a=t.fileName,i=t.fileNamePlaceHolder,s=e.fileName,n="fileName"),x("div",{class:$.formSectionContainer,key:n},x("label",null,a,x("input",{bind:this,class:this.classes($.inputText,v.input),"data-input-name":n,onchange:this._updateInputValue,placeholder:i,tabIndex:0,type:"text",value:s??""})))}_handleRootAfterCreate(e){this._rootNode=e,this.addHandles(a(e,"scroll",(()=>{this._templateListPopover.open&&this._handleCloseTemplateSelection()})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");("layoutTab"===t&&this._layoutTabSelected||"mapOnlyTab"===t&&!this._layoutTabSelected)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[$.loader]:this._awaitingServerResponse};return x("div",{class:this.classes(e),key:"loader"})}_createFileLink(e,t){const a=t||this.messages.untitled,i=e.format.toLowerCase(),s=i.includes("png")?"png":i,n=a+s;return void 0!==this._exportedFileNameMap[n]?this._exportedFileNameMap[n]++:this._exportedFileNameMap[n]=0,new m({name:a,extension:s,count:this._exportedFileNameMap[n]})}_resetToCurrentScale(){this.templateOptions.scale=this.viewModel.view?.scale}_updateCustomTextElementValue(e,t,a){e.find((e=>{const[a]=Object.entries(e)[0];return a===t}))[t]=a}_updateInputValue(e){const t=e.target,a=t.getAttribute("data-input-name"),i=!!t["data-input-custom"],{templateOptions:s}=this;if(i)return void this._updateCustomTextElementValue(s.customTextElements,a,t.value);let n;if("number"===t.type){if(!P(t.valueAsNumber)){const e=s[a];return void(t.value=`${e}`)}n=t.valueAsNumber}else n=t.value;s[a]=n}_handleDPIChange(e){this._updateInputValue(e);const t=e.currentTarget.valueAsNumber,{height:a,width:i}=E(t),{templateOptions:s}=this;s.height=a,s.width=i}_handlePrintMap(){this._pendingExportScroll=!0;const{templateOptions:e}=this,t=this.viewModel.toPrintTemplate(e),a=this._layoutTabSelected?t.layoutOptions?.titleText:e.fileName,i=this._createFileLink(t,a);this.exportedLinks.add(i),this.emit("submit",{link:i}),this.viewModel.print(t).then((e=>{i.set({url:e&&e.url,state:"ready"})})).catch((e=>{i.set({error:e,state:"error"})})).then((()=>{this.emit("complete",{link:i}),this.scheduleRender()}))}_updateFromOption(e){const t=e.target,a=t.selectedOptions?t.selectedOptions.item(0)?.value:t.options[t.selectedIndex].value,i=t.getAttribute("data-target-property");this.templateOptions[i]=a}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:t,scrollHeight:a}=e,i=a-t;i>0&&(e.scrollTop=i)}_toggleInputValue(e){const t=e.target,a=t.getAttribute("data-option-name");this.templateOptions[a]=t.checked,"scaleEnabled"===a&&(this.templateOptions[a]||this._resetToCurrentScale())}_renderExportedLink(e){const t=this.messages;return e.map((e=>{const{error:a,url:i,state:s}=e,n=e.formattedName??"",o="error"===s,l="pending"===s,d="ready"===s,c={[v.anchorDisabled]:l||o};let u=i||null;u&&(u=r(u));const h=p(i,location.href),m={[f.loadingIndicator]:l,[v.rotating]:l,[f.download]:h&&d,[f.launchLinkExternal]:!h&&d,[f.error]:o,[$.exportedFileError]:o},_={[$.exportedFileError]:o};let b;b=l?t.pending:d?t.ready:t.errorMessage;const y=o?"print-task:cim-symbol-unsupported"===a?.name?t.exportWebMapCIMError:t.exportWebMapError:"";return x("div",{"aria-label":b,class:$.exportedFile,"data-item":e,key:n,onclick:this._removeLink,title:y},x("a",{"aria-label":`${n}. ${t.linkReady}`,class:this.classes($.exportedFileLink,v.anchor,c),download:n,href:u??"",onclick:this._handleLinkClick,rel:"noreferrer",tabIndex:0,target:"_blank"},x("span",{class:this.classes(m)}),x("span",{class:this.classes($.exportedFileLinkTitle,_)},n)))}))}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e,t=!0){if(this._layoutTabSelected=e===I.layout,this._layoutTabSelected){const e=this.viewModel?.templatesInfo?.layout?.choiceList;this.templateOptions.layout=e?e[0]:"letter-ansi-a-landscape"}else this.templateOptions.layout=L;t&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const t=i(e),a=e.target.getAttribute("data-tab-id");if(T(t))return this._toggleTab(a),e.preventDefault(),void e.stopPropagation();"ArrowLeft"!==t&&"ArrowRight"!==t||(this._toggleTab(a===I.layout?I.mapOnly:I.layout),e.preventDefault(),e.stopPropagation())}};function B(e){return e?.["data-template"]}e([d()],A.prototype,"allowedFormats",null),e([d()],A.prototype,"allowedLayouts",null),e([d()],A.prototype,"error",null),e([d({type:C})],A.prototype,"exportedLinks",void 0),e([d()],A.prototype,"extraParameters",null),e([d()],A.prototype,"headingLevel",void 0),e([d()],A.prototype,"iconClass",void 0),e([d()],A.prototype,"icon",void 0),e([d()],A.prototype,"includeDefaultTemplates",null),e([d()],A.prototype,"label",null),e([d(),O("esri/widgets/Print/t9n/Print")],A.prototype,"messages",void 0),e([d(),O("esri/t9n/common")],A.prototype,"messagesCommon",void 0),e([d()],A.prototype,"portal",null),e([d()],A.prototype,"printServiceUrl",null),e([d()],A.prototype,"templateCustomTextElements",null),e([d({type:b})],A.prototype,"templateOptions",void 0),e([d()],A.prototype,"view",null),e([d({type:_})],A.prototype,"viewModel",void 0),A=e([c("esri.widgets.Print")],A);const D=A;export{D as default};
