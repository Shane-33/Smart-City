/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import"../../intl.js";import"../../core/has.js";import t from"../../core/Error.js";import{clamp as e}from"../../core/mathUtils.js";import{convertDateFormatToIntlOptions as n,formatTimestamp as o,formatTimeOnly as l,formatDateOnly as i,formatDate as r}from"../../intl/date.js";import{utc as a}from"../../time/timeZoneUtils.js";import{isString as u,isNumber as s}from"./dataUtils.js";import{DateTime as m,FixedOffsetZone as f,Interval as c}from"luxon";import{getLocale as d}from"../../intl/locale.js";const y=a,p={date:null,time:null,timeZoneOffset:null},h=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),v="yyyy-MM-dd",S="TT";var M;!function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"}(M||(M={}));const O=[M.HMS_MS,M.HMS,M.HM,S],w="latn",H=new Set(["date-only","time-only","timestamp-offset"]),j=t=>"valueAsDate"in t;function Z(t){return{locale:d(),numberingSystem:w,zone:t??y}}function g(t){return t?.isValid?t.toMillis():null}function x(t,e){return null===t?null:m.fromMillis(t,Z(e))}function V(t){if(null==t||!u(t)||""===t)return p;const e=m.fromISO(t,{setZone:!0});return{date:e.toFormat(v,Z()),time:e.toFormat(M.HMS_MS,Z()),timeZoneOffset:e.offset.toString()}}function I(t,e){if(null==t||!s(t)||isNaN(t))return p;const n=x(t,e);return n?{date:n.toFormat(v,Z(e)),time:n.toFormat(S,Z(e))}:p}function F(t){switch(t.type){case"date":default:return n("short-date-short-time");case"date-only":return n("short-date");case"time-only":return n("short-time");case"timestamp-offset":return{...n("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function T(t,e,n){if(!t||null==e)return null;switch(t.type){case"date":return r(e,n);case"date-only":return i(e,n);case"time-only":return l(e,n);case"timestamp-offset":return o(e,n);default:return null}}function C(t){const{dateComponent:e,timeComponent:n,timeZoneComponent:o,oldValue:l}=t;if(!e?.value||!n?.value)return null;const{year:i,month:r,day:u}=m.fromFormat(e.value,v),{hour:s,minute:c,second:d,millisecond:y}=b(n,a)??m.now(),p=V(l),h=null!=o?.value?parseInt(o.value,10):null!=p.timeZoneOffset?parseInt(p.timeZoneOffset,10):(new Date).getTimezoneOffset(),S=f.instance(h),M=m.fromObject({year:i,month:r,day:u,hour:s,minute:c,second:d,millisecond:y},{zone:S});return M.isValid?M.toISO({includeOffset:!0}):null}function D(t){const{dateComponent:e,timeComponent:n,timeZone:o,max:l,min:i,oldValue:r}=t,a=b(e,o);let u=!!t.applyRange;if(!a)return null;let s=null;if(null!=n?.value){const t=b(n,o),e=Date.now(),i=null!=l&&l<e?l:e,r=m.fromMillis(i,Z(o)),u=a||r,{year:f,month:c,day:d}=u,{hour:y,minute:p,second:h,millisecond:v}=t||r;s=u.set({year:f,month:c,day:d,hour:y,minute:p,second:h,millisecond:v})}else{const t=x(A({value:r??Date.now(),max:l,min:i}),o),{year:e,month:n,day:m}=a,{hour:f,minute:c,second:d,millisecond:y}=t;u=!0,s=a.set({year:e,month:n,day:m,hour:f,minute:c,second:d,millisecond:y})}if(!s.isValid)return null;const f=s.toMillis();return u?A({value:f,max:l,min:i}):f}function b(t,e){if(!t||null==t.value||Array.isArray(t.value))return null;let n=null;return n=j(t)?m.fromFormat(t.value,v,Z(e)):E(t.value),n?.isValid?n:null}function N(t){const{max:e,min:n,value:o}=t;return!isNaN(o)&&(!(null!=e&&o>e)&&!(null!=n&&o<n))}function A(t){const{max:n,min:o,value:l}=t;return null!=n&&null!=o?e(l,o,n):null!=n&&l>n?n:null!=o&&l<o?o:l}function z(e){if(!e)return"";const n=e.split(".").at(0);if(!n||n.length<1)throw new t("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const o=n.split(":"),l=new Array(3);for(let t=0;t<3;t++){const e=o.at(t)??"";l[t]=e.padStart(2,"0")}return l.join(":")}function U(t,e){switch(e){case"date":return t.getTime();case"date-only":return t.toISODate();case"time-only":return z(t.toISOTime(!0,!1));case"timestamp-offset":return t.toISOString(!1);default:return null}}function _(t){return!!t&&"object"==typeof t&&"getTime"in t&&"toISOString"in t&&"timeZone"in t}function k(t){return m.fromFormat(t,v)}function E(t){let e=null;return O.find((n=>(e=m.fromFormat(t,n),e.isValid))),e}function R(t){return m.fromISO(t)}function $(t){const{type:e,range:n,value:o}=t;if(null==o||!n)return!0;if("date"===e)return N({value:o,min:n.min,max:n.max});const{rawMax:l,rawMin:i}=n;if(!u(l)||!u(i)||!u(o))return!0;let r=null,a=null,s=null;switch(e){case"date-only":r=k(l),a=k(i),s=k(o);break;case"time-only":r=E(l),a=E(i),s=E(o);break;case"timestamp-offset":r=R(l),a=R(i),s=R(o)}return!(r?.isValid&&a?.isValid&&s?.isValid)||(c.fromDateTimes(a,r).contains(s)||a.valueOf()===s.valueOf()||r.valueOf()===s.valueOf())}export{M as TimeStampOffsetPattern,U as arcadeDateToFieldValue,A as clampValueToRange,x as createDateTimeFromFieldValue,H as dateFieldsWithStringFieldValue,k as dateOnlyToDateTime,$ as dateTimeIsInRange,g as dateTimeToFieldValue,v as defaultDatePattern,S as defaultTimePattern,Z as getDefaultLocaleOptions,C as getISOFieldValueFromDateComponents,F as getIntlOptionsForField,T as getLabelForDateFieldValue,b as getLocalDateTimeFromComponent,D as getUnixFieldValueFromDateComponents,_ as isArcadeDate,j as isCalciteDateComponent,z as normalizeTimeOnlyString,w as numberingSystem,V as prepareISOFieldValueForDateComponents,I as prepareUnixFieldValueForDateComponents,O as supportedTimeFormats,E as timeOnlyToDateTime,h as timeResolutionToStepMap,R as timestampOffsetToDateTime,N as valueIsInRange};
