/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import{createPopper as e}from"@popperjs/core";import"../../intl.js";import{remove as o,byId as r}from"../../core/domUtils.js";import{watch as s,initial as n}from"../../core/reactiveUtils.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import"../../core/accessorSupport/ensureType.js";import"../../core/arrayUtils.js";import"../../core/has.js";import{subclass as p}from"../../core/accessorSupport/decorators/subclass.js";import l from"../Widget.js";import{getDir as h}from"./widgetUtils.js";import{tsx as a}from"./jsxFactory.js";import{getLocale as c}from"../../intl/locale.js";const d=new Set(["bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end","top","top-start","top-end"]),u="esri-popover",m={base:u,open:`${u}--open`},_={position:"fixed","z-index":"1000"};let f=class extends l{constructor(t,e){super(t,e),this._popper=null,this._contentNode=null,this._renderAttached=!1,this._rootNode=null,this.anchorElement=null,this.offset=[0,0],this.open=!1,this.renderContentFunction=null,this._afterRootCreate=t=>{this._rootNode=t},this._afterContentCreate=t=>{this._contentNode=t},this._updatePosition=()=>{null!=this._popper&&this._popper.update()}}initialize(){this.when((()=>{this.destroyed||(this._projector.append(document.body,this.render),this._renderAttached=!0)})),this.addHandles([s((()=>[this.open,this.anchorElement]),(()=>this._buildPopper()),n),s((()=>[this.placement,this.offset]),(()=>this._setPopperOptions()),n)])}destroy(){this.owner=null,this.anchorElement=null,this.renderContentFunction=null,this._renderAttached&&(this._projector.detach(this.render),this._renderAttached=!1),null!=this._rootNode&&(o(this._rootNode),this._rootNode=null),this._contentNode=null,null!=this._popper&&(this._popper.destroy(),this._popper=null)}set container(t){}set owner(t){this._set("owner",t)}get placement(){return"top"}set placement(t){d.has(t)?this._override("placement",t):this._clearOverride("placement")}get test(){return{rootNode:this._rootNode}}render(){const{open:t,owner:e,renderContentFunction:o}=this;return a("div",{afterCreate:this._afterRootCreate,class:this.classes(m.base,t?m.open:null),lang:c(),styles:_},a("div",{afterCreate:this._afterContentCreate,afterUpdate:this._updatePosition,dir:h(this.owner?.container)},t?o?.call(e):null))}_buildPopper(){null!=this._popper&&(this._popper.destroy(),this._popper=null);const t=this._contentNode;if(null==t)return;if(!this.open||!this.renderContentFunction)return;const o=this._getAnchor();o&&(this._popper=e(o,t),this._setPopperOptions())}_setPopperOptions(){const{placement:t,offset:e,_popper:o}=this;null!=o&&(o.setOptions({placement:t,modifiers:[{name:"offset",options:{offset:e}}]}),o.forceUpdate())}_getAnchor(){const{anchorElement:t}=this;return r("function"==typeof t?t():t)}};t([i()],f.prototype,"anchorElement",void 0),t([i()],f.prototype,"container",null),t([i()],f.prototype,"offset",void 0),t([i()],f.prototype,"open",void 0),t([i()],f.prototype,"owner",null),t([i()],f.prototype,"placement",null),t([i()],f.prototype,"renderContentFunction",void 0),f=t([p("esri.widgets.support.Popover")],f);const y=f;export{y as default};
