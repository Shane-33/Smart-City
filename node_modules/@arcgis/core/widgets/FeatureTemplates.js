/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{watch as t,initial as r}from"../core/reactiveUtils.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import"../core/accessorSupport/ensureType.js";import"../core/arrayUtils.js";import"../core/has.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import{isTable as i}from"../layers/support/layerUtils.js";import n from"./Widget.js";import{isTemplateItemGroup as l}from"./FeatureForm/featureFormUtils.js";import a from"./FeatureTemplates/FeatureTemplatesViewModel.js";import{ItemList as d}from"./FeatureTemplates/ItemList.js";import c from"./FeatureTemplates/TemplateItem.js";import p from"./FeatureTemplates/VisibleElements.js";import{loadCalciteComponents as m}from"./support/componentsUtils.js";import{globalCss as u}from"./support/globalCss.js";import"./support/widgetUtils.js";import{messageBundle as h}from"./support/decorators/messageBundle.js";import{vmEvent as f}from"./support/decorators/vmEvent.js";import{tsx as v}from"./support/jsxFactory.js";const b="esri-feature-templates",I={base:b,loader:`${b}__loader`};function y(e){return e.length>0&&l(e[0])}function g(e){return e.id}let w=class extends n{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.selectionMode="none",this.viewModel=new a,this.visibleElements=new p,this.renderCustomItem=e=>null,this.renderCustomGroupContent=e=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=e=>null,this.renderItemContentEnd=e=>null,this._iconIntersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const r=e.target;if(j(r))return void t.unobserve(r);const o=C(r),{layer:s,template:i}=o;F(r,!0);const n=await c.fetchThumbnail(s,i).catch((()=>(F(r,!1),null)));if(null==n)return;r.appendChild(n)}}))})),this._renderItemIcon=e=>i(e.layer)?v("span",{"data-has-icon":!0,"data-item":e,key:"icon"},v("calcite-icon",{icon:"table"})):v("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":e,key:"icon"}),this._afterItemCreateOrUpdate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)}}initialize(){const e=({label:e})=>!this.filterText||!!e?.toLowerCase().includes(this.filterText.toLowerCase());this.addHandles(t((()=>this.viewModel),((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)}),r))}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return m({icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),input:()=>import("@esri/calcite-components/dist/components/calcite-input.js"),list:()=>import("@esri/calcite-components/dist/components/calcite-list.js"),"list-item":()=>import("@esri/calcite-components/dist/components/calcite-list-item.js"),notice:()=>import("@esri/calcite-components/dist/components/calcite-notice.js")})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:r,headingLevel:o,messages:s,viewModel:{items:i,numberOfFeatureTemplates:n,selectedItem:c,state:p}}=this,m=this.visibleElements.filter&&n>1;if(y(i)){const e=i.find((e=>e.label===a.nullGroupBy.label));e&&(e.label=s.other)}return v("div",{"aria-label":s.widgetLabel,class:this.classes(I.base,u.widget)},"loading"===p?this._renderLoader():"ready"===p?v(d,{disabled:e,enableListScroll:t,filterEnabled:m,filterText:r,headingLevel:o,id:this.id,identify:g,items:i,messages:{filterPlaceholder:s.filterPlaceholder,noItems:s.noItems,noMatches:s.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:c??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()},onItemSelect:e=>!l(e)&&this.viewModel.select(e)}):null)}_renderLoader(){return v("div",{class:I.loader,key:"loader"})}};function C(e){return e?.["data-item"]}function j(e){return!!e?.["data-has-icon"]}function F(e,t){e&&(e["data-has-icon"]=t)}e([o()],w.prototype,"disabled",null),e([o()],w.prototype,"enableListScroll",void 0),e([o()],w.prototype,"filterFunction",null),e([o()],w.prototype,"filterText",void 0),e([o()],w.prototype,"groupBy",null),e([o()],w.prototype,"headingLevel",void 0),e([o()],w.prototype,"label",null),e([o()],w.prototype,"layers",null),e([o(),h("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],w.prototype,"messages",void 0),e([o({readOnly:!0})],w.prototype,"selectedItem",null),e([o()],w.prototype,"selectionMode",void 0),e([o(),f("select")],w.prototype,"viewModel",void 0),e([o({type:p,nonNullable:!0})],w.prototype,"visibleElements",void 0),e([o()],w.prototype,"renderCustomItem",void 0),e([o()],w.prototype,"renderCustomGroupContent",void 0),e([o()],w.prototype,"renderItemLabel",void 0),e([o()],w.prototype,"renderItemDescription",void 0),e([o()],w.prototype,"renderItemContent",void 0),e([o()],w.prototype,"renderItemContentEnd",void 0),w=e([s("esri.widgets.FeatureTemplates")],w);const M=w;export{M as default};
