/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{deprecatedFunction as t}from"./deprecate.js";import e from"./Handles.js";import r from"./Logger.js";import{destroyMaybe as s}from"./maybe.js";import{beforeDestroySymbol as o}from"./accessorSupport/beforeDestroy.js";import{get as i}from"./accessorSupport/get.js";import{getPropertiesMetadata as c}from"./accessorSupport/metadata.js";import n from"./accessorSupport/Properties.js";import{set as a}from"./accessorSupport/set.js";import{getAccessorInterceptor as _}from"./accessorSupport/testSupport.js";import{removeTarget as l,watch as p}from"./accessorSupport/watch.js";import{property as h}from"./accessorSupport/decorators/property.js";import{subclass as u}from"./accessorSupport/decorators/subclass.js";var d,y;function m(t){if(null==t)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const f=Symbol("Accessor-Handles"),v=Symbol("Accessor-Initialized");class g{static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:e,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const o=this;class i extends o{constructor(...t){super(...t),this.inherited=null,s&&s.apply(this,t)}}c(i.prototype);for(const c in t){const e=t[c];i.prototype[c]="function"==typeof e?function(...t){const r=this.inherited;let s;this.inherited=function(...t){if(o.prototype[c])return o.prototype[c].apply(this,t)};try{s=e.apply(this,t)}catch(i){throw this.inherited=r,i}return this.inherited=r,s}:t[c]}for(const c in e){const t=m(e[c]);h(t)(i.prototype,c)}return u(r)(i)}constructor(...t){if(this[d]=null,this[y]=!1,this.constructor===g)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const e=new n(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:e}),t.length>0&&this.normalizeCtorArgs&&(e.ctorArgs=this.normalizeCtorArgs.apply(this,t)),_()?.onInstanceConstruct(this)}postscript(t){const e=this.__accessor__,r=e.ctorArgs||t;e.initialize(),r&&(this.set(r),e.ctorArgs=null),e.constructed(),this.initialize(),this[v]=!0}initialize(){}[o](){this[f]=s(this[f])}destroy(){this.destroyed||(l(this),this.__accessor__.destroy(),_()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[v]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){i(this,t)}get(e){return t(r.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),i(this,e)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,e){return a(this,t,e),this}watch(t,e,r){return p(this,t,e,r)}addHandles(t,r){if(this.destroyed){const e=Array.isArray(t)?t:[t];for(const t of e)t.remove();return}let s=this[f];null==s&&(s=this[f]=new e),s.add(t,r)}removeHandles(t){const e=this[f];null!=e&&e.remove(t)}removeAllHandles(){const t=this[f];null!=t&&t.removeAll()}hasHandles(t){const e=this[f];return null!=e&&e.has(t)}_override(t,e){void 0===e?this.__accessor__.clearOverride(t):this.__accessor__.override(t,e)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_overrideIfSome(t,e){null==e?this.__accessor__.clearOverride(t):this.__accessor__.override(t,e)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,e){return this.__accessor__.internalSet(t,e),this}}d=f,y=v;export{g as default};
