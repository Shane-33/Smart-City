/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import"../../has.js";import{beforeDestroySymbol as e}from"../beforeDestroy.js";import{Lifecycle as t}from"../interfaces.js";import{getPropertiesMetadata as r}from"../metadata.js";import{trackAccess as o}from"../tracking.js";import{processPrototypePropertyMetadata as s}from"../extensions/serializableProperty.js";const i=new Set,n=new Set;function c(t){return o=>{t??="esri.core.Accessor",o.prototype.declaredClass=t,l(o);const s=[],c=[];let a=o.prototype;for(;a;)a.hasOwnProperty("initialize")&&!i.has(a.initialize)&&(i.add(a.initialize),s.push(a.initialize)),a.hasOwnProperty("destroy")&&!n.has(a.destroy)&&(n.add(a.destroy),c.push(a.destroy)),a=Object.getPrototypeOf(a);i.clear(),n.clear();const p=class extends o{constructor(...t){if(super(...t),this.constructor===p&&"function"==typeof this.postscript){if(s.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let e=s.length-1;e>=0;e--)s[e].call(this)}}),c.length){let t=!1;const r=this[e];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!t){t=!0,r.call(this);for(let e=0;e<c.length;e++)c[e].call(this)}}})}this.postscript(...t)}}};p.__accessorMetadata__=r(o.prototype),p.prototype.declaredClass=t;const f=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(p,"name",{value:f,configurable:!0}),p}}function a(e,t){return null==t.get?function(){const t=this.__accessor__,r=t.propertiesByName.get(e);if(void 0===r)return;o(r);const s=t.store;return s.has(e)?s.get(e):r.metadata.value}:function(){const t=this.__accessor__,r=t.propertiesByName.get(e);if(void 0!==r)return r.getComputed(t)}}function l(e){const o=e.prototype,i=r(o),n={};for(const r of Object.getOwnPropertyNames(i)){const e=i[r];s(e),n[r]={enumerable:!0,configurable:!0,get:a(r,e),set(o){const s=this.__accessor__;if(void 0!==s){if(!Object.isFrozen(this)){if(s.initialized&&e.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${r}' of ${this.declaredClass}`);if(s.lifecycle===t.CONSTRUCTED&&e.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${r}' of ${this.declaredClass}`);s.set(r,o)}}else Object.defineProperty(this,r,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,n)}export{l as finalizeClass,c as subclass};
